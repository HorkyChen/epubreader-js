{"version":3,"file":"js/epubreader.js","mappings":";;;;;;;AAAa;;AAEb,sBAAsB,mBAAO,CAAC,GAAe;AAC7C,sBAAsB,mBAAO,CAAC,GAAwB;AACtD,sBAAsB,mBAAO,CAAC,GAAuB;AACrD,sBAAsB,mBAAO,CAAC,GAAkC;AAChE,sBAAsB,mBAAO,CAAC,GAA2B;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA,UAAU;AACV;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA,UAAU;AACV;AACA;;;;;;;;AC7Da;;AAEb;AACA;;;;;;;;ACHa;;AAEb,iBAAiB,mBAAO,CAAC,GAAkB,sBAAsB,mBAAO,CAAC,GAAQ;;;;;;;;ACFpE;;AAEb;AACA;AACA;AACA,SAAS;AACT,eAAe,YAAY,IAAI,cAAc;AAC7C;AACA;;;;;;;;ACRa;;AAEb,YAAY,mBAAO,CAAC,GAAS;AAC7B,YAAY,mBAAO,CAAC,GAAgB;AACpC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,aAAa,YAAY;AACzB;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACtBa;;AAEb,iBAAiB,mBAAO,CAAC,GAAkB,KAAK;;AAEhD,kCAAkC;;;;;;;;ACJrB;;AAEb,iBAAiB,mBAAO,CAAC,GAAkB,oBAAoB,mBAAO,CAAC,GAAQ;;;;;;;;ACFlE;;AAEb;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;;ACTa;;AAEb,cAAc,mBAAO,CAAC,GAAa;;AAEnC;;AAEA,qCAAqC;;;;;;;;ACNxB;;AAEb,cAAc,mBAAO,CAAC,GAAY;;AAElC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;;;;;;;ACnBa;;AAEb;AACA;AACA;AACA;;;;;;;;ACLa;;AAEb,cAAc,mBAAO,CAAC,GAAY;;AAElC;AACA;AACA;AACA;;;;;;;;ACPa;;AAEb,iBAAiB,mBAAO,CAAC,GAAkB,kCAAkC,mBAAO,CAAC,EAAQ;;;;;;;;ACFhF;;AAEb;;AAEA;AACA;AACA;AACA;;;;;;;;ACPa;;AAEb;;AAEA;AACA;AACA;;;;;;;;ACNa;;AAEb,eAAe,mBAAO,CAAC,GAAG;AAC1B,eAAe,mBAAO,CAAC,GAA+B;;AAEtD;AACA;AACA;AACA;AACA,mBAAmB;;AAEnB;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,cAAc,4BAA4B;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc,OAAO;;AAErB;AACA,cAAc,2BAA2B;AACzC;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,0BAA0B;;AAE1B;AACA;AACA;AACA,eAAe;;;;;;;;ACnIF;;AAEb,kBAAkB,mBAAO,CAAC,EAAiB;;AAE3C;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;;;;;;;;AClBa;;AAEb,cAAc,mBAAO,CAAC,GAAa;;AAEnC;AACA,sBAAsB;;AAEtB;AACA;AACA;AACA;;;;;;;;ACVa;;AAEb,iBAAiB,mBAAO,CAAC,GAAgB;;AAEzC,4BAA4B,EAAE;;AAE9B;AACA;AACA;AACA;AACA;;;;;;;;ACVa;;AAEb,eAAe,mBAAO,CAAC,GAAc;;AAErC;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;;ACZa;;AAEb;AACA;;AAEA,oCAAoC;;;;;;;UCLpC;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,sBAAsB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA,gCAAgC,qBAAqB;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,sBAAsB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,kBAAkB;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,KAAK;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,WAAW,GAAG;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,KAAK;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,SAAS;AACpB;AACA,yBAAyB,yDAAS;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,yDAAS;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,KAAK;AAChB;AACA,uBAAuB,yDAAS;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B;AAC1B,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,yDAAS;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,yDAAS;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,KAAK;AAChB;AACA,uBAAuB,yDAAS;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,yDAAS;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,GAAG;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE,KAAK;AACvE,cAAc;AACd;AACA,kEAAkE,KAAK;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,yDAAS;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,kBAAkB;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,6BAA6B;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,GAAG;AACd,WAAW,GAAG;AACd,WAAW,GAAG;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA0BE;;;ACrvC4C;AAC9C;AACO;AACP;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B,mBAAmB,MAAM;AACzB,qBAAqB,MAAM;AAC3B,uBAAuB,MAAM;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC7BmD;AACQ;AAC3D;AACO;AACP;AACA;AACA;AACA;AACA;AACA,8BAA8B,KAAK;AACnC;AACA,0BAA0B,OAAO;AACjC,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,aAAa;AACxC;AACA,wBAAwB,OAAO;AAC/B,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,eAAe;AACtE,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,6BAA6B,OAAO;AACpC;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,mCAAmC,OAAO;AAC1C;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;;ACrJ0E;AAC1E;AACO;AACP;AACA;AACA;AACA,yBAAyB,OAAO;AAChC;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,UAAU;AACxC;AACA;AACA;AACA,6BAA6B,MAAM;AACnC,iCAAiC,cAAc;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AC5DsD;AACtD;AACO;AACP;AACA;AACA;AACA;AACA;AACA,4BAA4B,KAAK;AACjC;AACA;AACA;AACA;AACA;AACA,0BAA0B,OAAO;AACjC,0BAA0B,OAAO;AACjC,0BAA0B,OAAO;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,OAAO;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC/IkE;AAClE;AACO;AACP;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA,sBAAsB,UAAU;AAChC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,KAAK;AAC3B,sBAAsB,KAAK;AAC3B;AACA,oBAAoB,OAAO;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,OAAO;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,4BAA4B;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,SAAS;AAC1B;AACA;AACA;AACA;AACA;;;AC9JsD;AACtD;AACO;AACP;AACA;AACA;AACA;AACA;AACA,yBAAyB,OAAO;AAChC;AACA;AACA,6BAA6B,OAAO;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA,4BAA4B,KAAK;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,GAAG;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjFoF;AACpF;AACO;AACP;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA,0BAA0B,KAAK;AAC/B,uBAAuB,QAAQ,gBAAgB,4DAA4D;AAC3G;AACA;AACA;AACA,GAAG;AACH;AACA,sBAAsB,OAAO;AAC7B;AACA;AACA;AACA,0BAA0B,KAAK;AAC/B,uBAAuB,SAAS;AAChC;AACA;AACA;AACA,GAAG;AACH;AACA,sBAAsB,OAAO;AAC7B;AACA;AACA;AACA,4BAA4B,KAAK;AACjC,yBAAyB,OAAO;AAChC;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,wBAAwB,OAAO;AAC/B;AACA;AACA;AACA,4BAA4B,KAAK;AACjC,yBAAyB,OAAO;AAChC;AACA;AACA;AACA;AACA,gCAAgC;AAChC,GAAG;AACH;AACA,wBAAwB,OAAO;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;;AC/EyC;AACQ;AACY;AACI;AACV;AACI;AAC3D;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,QAAQ;AAC/B,6BAA6B,cAAc;AAC3C,+BAA+B,gBAAgB;AAC/C,0BAA0B,WAAW;AACrC,4BAA4B,aAAa;AACzC;AACA,6BAA6B,aAAa;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtC0C;AAC1C;AACO;AACP;AACA;AACA;AACA,wBAAwB,KAAK;AAC7B;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,yBAAyB,KAAK;AAC9B;AACA;AACA;AACA;AACA;AACA,qBAAqB,OAAO;AAC5B;AACA,yBAAyB,KAAK;AAC9B;AACA;AACA;AACA;AACA;AACA,qBAAqB,OAAO;AAC5B;AACA,4BAA4B,KAAK;AACjC,4BAA4B,KAAK;AACjC,4BAA4B,KAAK;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,+BAA+B,6BAA6B;AAC5D,SAAS;AACT;AACA;AACA;AACA;AACA,+BAA+B,6BAA6B;AAC5D,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;ACnJO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;;;AC9GyC;AACzC;AACmD;AACA;AACA;AACZ;AACvC;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,OAAO;AAClC,2BAA2B,OAAO;AAClC,2BAA2B,OAAO;AAClC,2BAA2B,OAAO;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,IAAI,gBAAgB;AAC7B;AACA;AACA;AACA;AACA,eAAe,GAAG;AAClB,eAAe,GAAG;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,YAAY;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,GAAG;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,GAAG;AAClB,eAAe,GAAG;AAClB;AACA;AACA;AACA,oDAAoD;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,GAAG;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,GAAG;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,YAAY;AACtB;AACA;AACA;AACA;AACA;AACA;AACA,+EAA+E;AAC/E;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAY;;;AC7YL;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACpGqC;AACE;AACvC;AACA;AACA;AACA;AACA;AACA,qBAAqB,OAAO;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,MAAM,SAAS,eAAe;AACtD;AACA,KAAK;AACL;AACA,wBAAwB,MAAM,SAAS,eAAe;AACtD;AACA,GAAG;AACH,EAAE;AACF;AACA;AACA,E","sources":["webpack://epubjs-reader/./node_modules/d/index.js","webpack://epubjs-reader/./node_modules/es5-ext/function/noop.js","webpack://epubjs-reader/./node_modules/es5-ext/object/assign/index.js","webpack://epubjs-reader/./node_modules/es5-ext/object/assign/is-implemented.js","webpack://epubjs-reader/./node_modules/es5-ext/object/assign/shim.js","webpack://epubjs-reader/./node_modules/es5-ext/object/is-value.js","webpack://epubjs-reader/./node_modules/es5-ext/object/keys/index.js","webpack://epubjs-reader/./node_modules/es5-ext/object/keys/is-implemented.js","webpack://epubjs-reader/./node_modules/es5-ext/object/keys/shim.js","webpack://epubjs-reader/./node_modules/es5-ext/object/normalize-options.js","webpack://epubjs-reader/./node_modules/es5-ext/object/valid-callable.js","webpack://epubjs-reader/./node_modules/es5-ext/object/valid-value.js","webpack://epubjs-reader/./node_modules/es5-ext/string/\u0000#/contains/index.js","webpack://epubjs-reader/./node_modules/es5-ext/string/\u0000#/contains/is-implemented.js","webpack://epubjs-reader/./node_modules/es5-ext/string/\u0000#/contains/shim.js","webpack://epubjs-reader/./node_modules/event-emitter/index.js","webpack://epubjs-reader/./node_modules/type/function/is.js","webpack://epubjs-reader/./node_modules/type/object/is.js","webpack://epubjs-reader/./node_modules/type/plain-function/is.js","webpack://epubjs-reader/./node_modules/type/prototype/is.js","webpack://epubjs-reader/./node_modules/type/value/is.js","webpack://epubjs-reader/webpack/bootstrap","webpack://epubjs-reader/webpack/runtime/compat get default export","webpack://epubjs-reader/webpack/runtime/define property getters","webpack://epubjs-reader/webpack/runtime/hasOwnProperty shorthand","webpack://epubjs-reader/./src/ui.js","webpack://epubjs-reader/./src/controllers/panels/metadata_panel.js","webpack://epubjs-reader/./src/controllers/toolbar.js","webpack://epubjs-reader/./src/controllers/panels/toc_panel.js","webpack://epubjs-reader/./src/controllers/panels/bookmarks_panel.js","webpack://epubjs-reader/./src/controllers/panels/annotations_panel.js","webpack://epubjs-reader/./src/controllers/panels/search_panel.js","webpack://epubjs-reader/./src/controllers/panels/settings_panel.js","webpack://epubjs-reader/./src/controllers/sidebar.js","webpack://epubjs-reader/./src/controllers/content.js","webpack://epubjs-reader/./src/strings.js","webpack://epubjs-reader/./src/reader.js","webpack://epubjs-reader/./src/storage.js","webpack://epubjs-reader/./src/main.js"],"sourcesContent":["\"use strict\";\n\nvar isValue         = require(\"type/value/is\")\n  , isPlainFunction = require(\"type/plain-function/is\")\n  , assign          = require(\"es5-ext/object/assign\")\n  , normalizeOpts   = require(\"es5-ext/object/normalize-options\")\n  , contains        = require(\"es5-ext/string/#/contains\");\n\nvar d = (module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif (arguments.length < 2 || typeof dscr !== \"string\") {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t\tw = contains.call(dscr, \"w\");\n\t} else {\n\t\tc = w = true;\n\t\te = false;\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n});\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== \"string\") {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (!isValue(get)) {\n\t\tget = undefined;\n\t} else if (!isPlainFunction(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (!isValue(set)) {\n\t\tset = undefined;\n\t} else if (!isPlainFunction(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t} else {\n\t\tc = true;\n\t\te = false;\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","\"use strict\";\n\n// eslint-disable-next-line no-empty-function\nmodule.exports = function () {};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.assign : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== \"function\") return false;\n\tobj = { foo: \"raz\" };\n\tassign(obj, { bar: \"dwa\" }, { trzy: \"trzy\" });\n\treturn obj.foo + obj.bar + obj.trzy === \"razdwatrzy\";\n};\n","\"use strict\";\n\nvar keys  = require(\"../keys\")\n  , value = require(\"../valid-value\")\n  , max   = Math.max;\n\nmodule.exports = function (dest, src /*, …srcn*/) {\n\tvar error, i, length = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry {\n\t\t\tdest[key] = src[key];\n\t\t} catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < length; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","\"use strict\";\n\nvar _undefined = require(\"../function/noop\")(); // Support ES3 engines\n\nmodule.exports = function (val) { return val !== _undefined && val !== null; };\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.keys : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys(\"primitive\");\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nvar isValue = require(\"../is-value\");\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) { return keys(isValue(object) ? Object(object) : object); };\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\n// eslint-disable-next-line no-unused-vars\nmodule.exports = function (opts1 /*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (!isValue(options)) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","\"use strict\";\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== \"function\") throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? String.prototype.contains : require(\"./shim\");\n","\"use strict\";\n\nvar str = \"razdwatrzy\";\n\nmodule.exports = function () {\n\tif (typeof str.contains !== \"function\") return false;\n\treturn str.contains(\"dwa\") === true && str.contains(\"foo\") === false;\n};\n","\"use strict\";\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString /*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","\"use strict\";\n\nvar isPrototype = require(\"../prototype/is\");\n\nmodule.exports = function (value) {\n\tif (typeof value !== \"function\") return false;\n\n\tif (!hasOwnProperty.call(value, \"length\")) return false;\n\n\ttry {\n\t\tif (typeof value.length !== \"number\") return false;\n\t\tif (typeof value.call !== \"function\") return false;\n\t\tif (typeof value.apply !== \"function\") return false;\n\t} catch (error) {\n\t\treturn false;\n\t}\n\n\treturn !isPrototype(value);\n};\n","\"use strict\";\n\nvar isValue = require(\"../value/is\");\n\n// prettier-ignore\nvar possibleTypes = { \"object\": true, \"function\": true, \"undefined\": true /* document.all */ };\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) return false;\n\treturn hasOwnProperty.call(possibleTypes, typeof value);\n};\n","\"use strict\";\n\nvar isFunction = require(\"../function/is\");\n\nvar classRe = /^\\s*class[\\s{/}]/, functionToString = Function.prototype.toString;\n\nmodule.exports = function (value) {\n\tif (!isFunction(value)) return false;\n\tif (classRe.test(functionToString.call(value))) return false;\n\treturn true;\n};\n","\"use strict\";\n\nvar isObject = require(\"../object/is\");\n\nmodule.exports = function (value) {\n\tif (!isObject(value)) return false;\n\ttry {\n\t\tif (!value.constructor) return false;\n\t\treturn value.constructor.prototype === value;\n\t} catch (error) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\n// ES3 safe\nvar _undefined = void 0;\n\nmodule.exports = function (value) { return value !== _undefined && value !== null; };\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/**\r\n * @author mrdoob (https://github.com/mrdoob/ui.js)\r\n */\r\n\r\nconst errormsg = 'is not an instance of UIElement.';\r\n\r\n/**\r\n * UIElement\r\n * @param {object} dom\r\n */\r\nclass UIElement {\r\n\r\n    constructor(dom) {\r\n\r\n        this.dom = dom;\r\n    }\r\n\r\n    add() {\r\n\r\n        for (let i = 0; i < arguments.length; i++) {\r\n\r\n            const argument = arguments[i];\r\n\r\n            if (argument instanceof UIElement) {\r\n\r\n                this.dom.appendChild(argument.dom);\r\n\r\n            } else if (Array.isArray(argument)) {\r\n                \r\n                for (let j = 0; j < argument.length; j++) {\r\n\r\n                    const element = argument[j];\r\n\r\n                    if (element instanceof UIElement) {\r\n\r\n                        this.dom.appendChild(element.dom);\r\n\r\n                    } else {\r\n\r\n                        console.error('UIElement:', element, errormsg);\r\n                    }\r\n                }\r\n                \r\n            } else {\r\n\r\n                console.error('UIElement:', argument, errormsg);\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    remove() {\r\n\r\n        for (let i = 0; i < arguments.length; i++) {\r\n\r\n            const argument = arguments[i];\r\n\r\n            if (argument instanceof UIElement) {\r\n\r\n                this.dom.removeChild(argument.dom);\r\n\r\n            } else {\r\n\r\n                console.error('UIElement:', argument, errormsg);\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    clear() {\r\n\r\n        while (this.dom.children.length) {\r\n\r\n            this.dom.removeChild(this.dom.lastChild);\r\n        }\r\n    }\r\n\r\n    setId(id) {\r\n\r\n        this.dom.id = id;\r\n        return this;\r\n    }\r\n\r\n    getId() {\r\n\r\n        return this.dom.id;\r\n    }\r\n\r\n    setClass(name) {\r\n\r\n        this.dom.className = name;\r\n        return this;\r\n    }\r\n\r\n    addClass(name) {\r\n\r\n        this.dom.classList.add(name);\r\n        return this;\r\n    }\r\n\r\n    removeClass(name) {\r\n\r\n        this.dom.classList.remove(name);\r\n        return this;\r\n    }\r\n\r\n    setStyle(style, array) {\r\n\r\n        for (let i = 0; i < array.length; i++) {\r\n\r\n            this.dom.style[style] = array[i];\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    setDisabled(value) {\r\n\r\n        this.dom.disabled = value;\r\n        return this;\r\n    }\r\n\r\n    setTextContent(value) {\r\n\r\n        this.dom.textContent = value;\r\n        return this;\r\n    }\r\n\r\n    getRect() {\r\n\r\n        this.dom.getBoundingClientRect();\r\n        return this;\r\n    }\r\n}\r\n\r\n// properties\r\n\r\nconst properties = [\r\n    'position',\r\n    'left',\r\n    'top',\r\n    'right',\r\n    'bottom',\r\n    'width',\r\n    'height',\r\n    'border',\r\n    'borderLeft',\r\n    'borderTop',\r\n    'borderRight',\r\n    'borderBottom',\r\n    'borderColor',\r\n    'display',\r\n    'overflow',\r\n    'margin',\r\n    'marginLeft',\r\n    'marginTop',\r\n    'marginRight',\r\n    'marginBottom',\r\n    'padding',\r\n    'paddingLeft',\r\n    'paddingTop',\r\n    'paddingRight',\r\n    'paddingBottom',\r\n    'color',\r\n    'background',\r\n    'backgroundColor',\r\n    'opacity',\r\n    'fontSize',\r\n    'fontWeight',\r\n    'textAlign',\r\n    'textDecoration',\r\n    'textTransform',\r\n    'cursor',\r\n    'zIndex'\r\n];\r\n\r\nproperties.forEach(function (property) {\r\n\r\n    const method = 'set' +\r\n        property.substr(0, 1).toUpperCase() +\r\n        property.substr(1, property.length);\r\n\r\n    UIElement.prototype[method] = function () {\r\n\r\n        this.setStyle(property, arguments);\r\n\r\n        return this;\r\n    };\r\n});\r\n\r\n// events\r\n\r\nconst events = [\r\n    'KeyUp', \r\n    'KeyDown', \r\n    'MouseOver', \r\n    'MouseOut', \r\n    'Click', \r\n    'DblClick', \r\n    'Change', \r\n    'Input'\r\n];\r\n\r\nevents.forEach(function (event) {\r\n\r\n    const method = 'on' + event;\r\n\r\n    UIElement.prototype[method] = function (callback) {\r\n\r\n        this.dom.addEventListener(event.toLowerCase(), callback.bind(this), false);\r\n        return this;\r\n    };\r\n});\r\n\r\n/**\r\n * UISpan\r\n */\r\nclass UISpan extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('span'));\r\n    }\r\n}\r\n\r\n/**\r\n * UIDiv\r\n */\r\nclass UIDiv extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('div'));\r\n    }\r\n}\r\n\r\n/**\r\n * UIRow\r\n */\r\nclass UIRow extends UIDiv {\r\n\r\n    constructor() {\r\n\r\n        super();\r\n        this.dom.className = 'row';\r\n    }\r\n}\r\n\r\n/**\r\n * UIPanel\r\n */\r\nclass UIPanel extends UIDiv {\r\n\r\n    constructor() {\r\n\r\n        super();\r\n        this.dom.className = 'panel';\r\n    }\r\n}\r\n\r\nclass UILabel extends UIElement {\r\n\r\n    constructor(text, id) {\r\n\r\n        super(document.createElement('label'));\r\n        this.dom.textContent = text;\r\n        if (id) this.dom.htmlFor = id;\r\n    }\r\n}\r\n\r\n/**\r\n * UIText\r\n * @param {any} text\r\n */\r\nclass UIText extends UISpan {\r\n\r\n    constructor(text) {\r\n\r\n        super();\r\n        this.setValue(text);\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.textContent;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        if (value !== undefined) {\r\n\r\n            this.dom.textContent = value;\r\n        }\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UILink\r\n * @param {*} uri\r\n * @param {*} label\r\n */\r\nclass UILink extends UIElement {\r\n\r\n    constructor(uri, label) {\r\n\r\n        super(document.createElement('a'));\r\n        this.dom.href = uri;\r\n        this.dom.textContent = label;\r\n    }\r\n}\r\n\r\n/**\r\n * UIInput\r\n * @param {any} value\r\n */\r\nclass UIInput extends UIElement {\r\n\r\n    constructor(type, value, title) {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        this.dom.type = type;\r\n        this.dom.addEventListener('keydown', function (event) {\r\n\r\n            event.stopPropagation();\r\n\r\n        }, false);\r\n\r\n        this.setValue(value);\r\n        this.setTitle(title);\r\n    }\r\n\r\n    getName() {\r\n\r\n        return this.dom.name;\r\n    }\r\n\r\n    setName(name) {\r\n\r\n        this.dom.name = name;\r\n        return this;\r\n    }\r\n\r\n    getType() {\r\n\r\n        return this.dom.type;\r\n    }\r\n\r\n    setType(type) {\r\n\r\n        this.dom.type = type;\r\n        return this;\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.value;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        if (value !== undefined) {\r\n            this.dom.value = value;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    getTitle() {\r\n\r\n        return this.dom.title;\r\n    }\r\n\r\n    setTitle(text) {\r\n\r\n        if (text !== undefined) {\r\n            this.dom.title = text;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    readonly(value) {\r\n\r\n        this.dom.readOnly = value;\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UITextArea\r\n */\r\nclass UITextArea extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('textarea'));\r\n\r\n        this.dom.spellcheck = false;\r\n        this.dom.addEventListener('keydown', function (event) {\r\n\r\n            event.stopPropagation();\r\n\r\n            if (event.keyCode === 9) {\r\n\r\n                event.preventDefault();\r\n\r\n                const cursor = dom.selectionStart;\r\n\r\n                this.dom.value = this.dom.value.substring(0, cursor) + '\\t' + this.dom.value.substring(cursor);\r\n                this.dom.selectionStart = cursor + 1;\r\n                this.dom.selectionEnd = this.dom.selectionStart;\r\n            }\r\n\r\n        }, false);\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.value;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        this.dom.value = value;\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * The <select> element is used to create a drop-down list.\r\n */\r\nclass UISelect extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('select'));\r\n    }\r\n\r\n    setMultiple(boolean) {\r\n\r\n        this.dom.multiple = boolean || false;\r\n        return this;\r\n    }\r\n\r\n    setOptions(options) {\r\n\r\n        const selected = this.dom.value;\r\n\r\n        while (this.dom.children.length > 0) {\r\n\r\n            this.dom.removeChild(this.dom.firstChild);\r\n        }\r\n\r\n        for (const key in options) {\r\n\r\n            const option = document.createElement('option');\r\n            option.value = key;\r\n            option.innerHTML = options[key];\r\n            this.dom.appendChild(option);\r\n        }\r\n\r\n        this.dom.value = selected;\r\n\r\n        return this;\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.value;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        value = String(value);\r\n\r\n        if (this.dom.value !== value) {\r\n\r\n            this.dom.value = value;\r\n        }\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UICheckbox\r\n * @param {boolean} value\r\n */\r\nclass UICheckbox extends UIElement {\r\n\r\n    constructor(value) {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        this.dom.type = 'checkbox';\r\n        this.setValue(value);\r\n    }\r\n\r\n    getName() {\r\n\r\n        return this.dom.name;\r\n    }\r\n\r\n    setName(name) {\r\n\r\n        this.dom.name = name;\r\n        return this;\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.checked;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        if (value !== undefined) {\r\n\r\n            this.dom.checked = value;\r\n        }\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UIColor\r\n */\r\nclass UIColor extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        try {\r\n\r\n            this.dom.type = 'color';\r\n            this.dom.value = '#ffffff';\r\n\r\n        } catch (e) {\r\n\r\n            console.exception(e);\r\n        }\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.value;\r\n    }\r\n\r\n    getHexValue() {\r\n\r\n        return parseInt(this.dom.value.substr(1), 16);\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        this.dom.value = value;\r\n        return this;\r\n    }\r\n\r\n    setHexValue(hex) {\r\n\r\n        this.dom.value = '#' + ('000000' + hex.toString(16)).slice(-6);\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UINumber\r\n * @param {any} number\r\n */\r\nclass UINumber extends UIElement {\r\n\r\n    constructor(number) {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        \r\n        this.dom.type = 'number';\r\n        this.dom.value = '0.00';\r\n\r\n        this.value = 0;\r\n\r\n        this.min = - Infinity;\r\n        this.max = + Infinity;\r\n\r\n        this.precision = 2;\r\n        this.step = 1;\r\n        this.unit = '';\r\n        this.nudge = 0.01;\r\n\r\n        this.setValue(number);\r\n\r\n        const scope = this;\r\n\r\n        const changeEvent = document.createEvent('HTMLEvents');\r\n        changeEvent.initEvent('change', true, true);\r\n\r\n        let distance = 0;\r\n        let onMouseDownValue = 0;\r\n\r\n        const pointer = { x: 0, y: 0 };\r\n        const prevPointer = { x: 0, y: 0 };\r\n\r\n        function onMouseDown(event) {\r\n\r\n            event.preventDefault();\r\n\r\n            distance = 0;\r\n\r\n            onMouseDownValue = scope.value;\r\n\r\n            prevPointer.x = event.clientX;\r\n            prevPointer.y = event.clientY;\r\n\r\n            document.addEventListener('mousemove', onMouseMove, false);\r\n            document.addEventListener('mouseup', onMouseUp, false);\r\n        }\r\n\r\n        function onMouseMove(event) {\r\n\r\n            const currentValue = scope.value;\r\n\r\n            pointer.x = event.clientX;\r\n            pointer.y = event.clientY;\r\n\r\n            distance += (pointer.x - prevPointer.x) - (pointer.y - prevPointer.y);\r\n\r\n            let value = onMouseDownValue + (distance / (event.shiftKey ? 5 : 50)) * scope.step;\r\n            value = Math.min(scope.max, Math.max(scope.min, value));\r\n\r\n            if (currentValue !== value) {\r\n\r\n                scope.setValue(value);\r\n                scope.dom.dispatchEvent(changeEvent);\r\n            }\r\n\r\n            prevPointer.x = event.clientX;\r\n            prevPointer.y = event.clientY;\r\n        }\r\n\r\n        function onMouseUp() {\r\n\r\n            document.removeEventListener('mousemove', onMouseMove, false);\r\n            document.removeEventListener('mouseup', onMouseUp, false);\r\n\r\n            if (Math.abs(distance) < 2) {\r\n\r\n                scope.dom.focus();\r\n                scope.dom.select();\r\n            }\r\n        }\r\n\r\n        function onTouchStart(event) {\r\n\r\n            if (event.touches.length === 1) {\r\n\r\n                distance = 0;\r\n\r\n                onMouseDownValue = scope.value;\r\n\r\n                prevPointer.x = event.touches[0].pageX;\r\n                prevPointer.y = event.touches[0].pageY;\r\n\r\n                document.addEventListener('touchmove', onTouchMove, false);\r\n                document.addEventListener('touchend', onTouchEnd, false);\r\n            }\r\n        }\r\n\r\n        function onTouchMove(event) {\r\n\r\n            const currentValue = scope.value;\r\n\r\n            pointer.x = event.touches[0].pageX;\r\n            pointer.y = event.touches[0].pageY;\r\n\r\n            distance += (pointer.x - prevPointer.x) - (pointer.y - prevPointer.y);\r\n\r\n            let value = onMouseDownValue + (distance / (event.shiftKey ? 5 : 50)) * scope.step;\r\n            value = Math.min(scope.max, Math.max(scope.min, value));\r\n\r\n            if (currentValue !== value) {\r\n\r\n                scope.setValue(value);\r\n                scope.dom.dispatchEvent(changeEvent);\r\n            }\r\n\r\n            prevPointer.x = event.touches[0].pageX;\r\n            prevPointer.y = event.touches[0].pageY;\r\n        }\r\n\r\n        function onTouchEnd(event) {\r\n\r\n            if (event.touches.length === 0) {\r\n\r\n                document.removeEventListener('touchmove', onTouchMove, false);\r\n                document.removeEventListener('touchend', onTouchEnd, false);\r\n            }\r\n        }\r\n\r\n        function onChange() {\r\n\r\n            scope.setValue(this.value);\r\n        }\r\n\r\n        //function onFocus() {\r\n        //    dom.style.backgroundColor = '';\r\n        //    dom.style.cursor = '';\r\n        //}\r\n        //function onBlur() {\r\n        //    dom.style.backgroundColor = 'transparent';\r\n        //    dom.style.cursor = 'ns-resize';\r\n        //}\r\n\r\n        function onKeyDown(event) {\r\n\r\n            event.stopPropagation();\r\n\r\n            switch (event.keyCode) {\r\n\r\n                //case 13: // enter\r\n                //    dom.blur();\r\n                //    break;\r\n                case 38: // up\r\n                    event.preventDefault();\r\n                    scope.setValue(scope.getValue() + scope.nudge);\r\n                    scope.dom.dispatchEvent(changeEvent);\r\n                    break;\r\n                case 40: // down\r\n                    event.preventDefault();\r\n                    scope.setValue(scope.getValue() - scope.nudge);\r\n                    scope.dom.dispatchEvent(changeEvent);\r\n                    break;\r\n            }\r\n        }\r\n\r\n        //onBlur();\r\n        this.dom.addEventListener('keydown', onKeyDown, false);\r\n        this.dom.addEventListener('mousedown', onMouseDown, false);\r\n        this.dom.addEventListener('touchstart', onTouchStart, false);\r\n        this.dom.addEventListener('change', onChange, false);\r\n        //dom.addEventListener('focus', onFocus, false);\r\n        //dom.addEventListener('blur', onBlur, false);\r\n    }\r\n\r\n    getName() {\r\n\r\n        return this.dom.name;\r\n    }\r\n\r\n    setName(name) {\r\n\r\n        this.dom.name = name;\r\n        return this;\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return parseFloat(this.dom.value);\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        if (value !== undefined) {\r\n\r\n            value = parseFloat(value);\r\n\r\n            if (value < this.min)\r\n                value = this.min;\r\n            if (value > this.max)\r\n                value = this.max;\r\n\r\n            this.value = value;\r\n            this.dom.value = value.toFixed(this.precision);\r\n\r\n            if (this.unit !== '')\r\n                this.dom.value += ' ' + this.unit;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    setPrecision(precision) {\r\n\r\n        this.precision = precision;\r\n        return this;\r\n    }\r\n\r\n    setStep(step) {\r\n\r\n        this.step = step;\r\n        return this;\r\n    }\r\n\r\n    setNudge(nudge) {\r\n\r\n        this.nudge = nudge;\r\n        return this;\r\n    }\r\n\r\n    setRange(min, max) {\r\n\r\n        this.min = min;\r\n        this.max = max;\r\n\r\n        return this;\r\n    }\r\n\r\n    setUnit(unit) {\r\n\r\n        this.unit = unit;\r\n        return this;\r\n    }\r\n\r\n    setTitle(text) {\r\n\r\n        this.dom.title = text;\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UIInteger\r\n * @param {number} value\r\n * @param {number} step\r\n * @param {number} min\r\n * @param {number} max\r\n */\r\nclass UIInteger extends UIElement {\r\n\r\n    constructor(value, step, min, max) {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        this.dom.type = 'number';\r\n        this.dom.value = value;\r\n\r\n        if (step != undefined)\r\n        {\r\n            this.dom.step = step;\r\n        }\r\n        \r\n        if (min !== undefined)\r\n        {\r\n            this.dom.min = min;\r\n        }\r\n\r\n        if (max !== undefined)\r\n        {\r\n            this.dom.max = max;\r\n        }\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.value;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        if (value !== undefined) {\r\n            \r\n            this.dom.value = value;\r\n        }\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UIBreak\r\n */\r\nclass UIBreak extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('br'));\r\n\r\n        this.dom.className = 'Break';\r\n    }\r\n}\r\n\r\n/**\r\n * UIHorizontalRule\r\n */\r\nclass UIHorizontalRule extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('hr'));\r\n\r\n        this.dom.className = 'HorizontalRule';\r\n    }\r\n}\r\n\r\n/**\r\n * UIButton\r\n * @param {any} value\r\n */\r\nclass UIButton extends UIElement {\r\n\r\n    constructor(value) {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        this.dom.type = 'button';\r\n\r\n        if (value !== undefined) {\r\n\r\n            this.dom.value = value;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        this.dom.value = value;\r\n        return this;\r\n    }\r\n}\r\n\r\nclass UIProgress extends UIElement {\r\n\r\n    constructor(value) {\r\n\r\n        super(document.createElement('progress'));\r\n\r\n        this.dom.value = value;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        this.dom.value = value;\r\n    }\r\n}\r\n\r\n/**\r\n * UITabbedPanel\r\n */\r\nclass UITabbedPanel extends UIDiv {\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {*} align (horizontal | vertical)\r\n     */\r\n    constructor(align) {\r\n\r\n        super();\r\n\r\n        this.tabs = [];\r\n        this.panels = [];\r\n        this.selector = new UISpan().setClass('tab-selector');\r\n\r\n        this.tabsDiv = new UIDiv();\r\n        this.tabsDiv.dom.className = 'tabs';\r\n        this.tabsDiv.add(this.selector);\r\n\r\n        this.panelsDiv = new UIDiv();\r\n        this.panelsDiv.dom.className = 'panels';\r\n\r\n        this.add(this.tabsDiv);\r\n        this.add(this.panelsDiv);\r\n\r\n        this.align = align || 'horizontal';\r\n        this.selected = '';\r\n    }\r\n\r\n    select(id) {\r\n\r\n        let tab;\r\n        let panel;\r\n\r\n        // Deselect current selection\r\n        if (this.selected && this.selected.length) {\r\n\r\n            tab = this.tabs.find((item) => {\r\n\r\n                return item.dom.id === this.selected;\r\n            });\r\n\r\n            panel = this.panels.find((item) => {\r\n\r\n                return item.dom.id === this.selected;\r\n            });\r\n\r\n            if (tab) {\r\n\r\n                tab.removeClass('selected');\r\n            }\r\n\r\n            if (panel) {\r\n\r\n                panel.setDisplay('none');\r\n            }\r\n        }\r\n\r\n        tab = this.tabs.find(function (item) {\r\n\r\n            return item.dom.id === id;\r\n        });\r\n\r\n        panel = this.panels.find(function (item) {\r\n\r\n            return item.dom.id === id;\r\n        });\r\n\r\n        if (tab) {\r\n\r\n            tab.addClass('selected');\r\n            //\r\n            // transforming the tab-selector element\r\n            //\r\n            let size;\r\n            const rect = tab.dom.getBoundingClientRect();\r\n            if (this.align === 'horizontal') {\r\n                size = rect.width * this.tabs.indexOf(tab);\r\n                this.selector.dom.style.transform = `translateX(${size}px)`;\r\n            } else {\r\n                size = rect.height * this.tabs.indexOf(tab);\r\n                this.selector.dom.style.transform = `translateY(${size}px)`;\r\n            }\r\n        }\r\n\r\n        if (panel) {\r\n\r\n            panel.setDisplay('');\r\n        }\r\n\r\n        this.selected = id;\r\n\r\n        return this;\r\n    }\r\n\r\n    addTab(id, label, items) {\r\n\r\n        const tab = new UITab(label, this);\r\n        tab.setId(id);\r\n        tab.setClass('tab');\r\n        this.tabs.push(tab);\r\n        this.tabsDiv.add(tab);\r\n\r\n        const panel = new UIDiv();\r\n        panel.setId(id);\r\n        panel.add(items);\r\n        panel.setDisplay('none');\r\n        this.panels.push(panel);\r\n        this.panelsDiv.add(panel);\r\n\r\n        this.select(id);\r\n    }\r\n}\r\n\r\n/**\r\n * UITab\r\n */\r\nclass UITab extends UIDiv {\r\n\r\n    constructor(text, parent) {\r\n\r\n        super(text);\r\n\r\n        this.button = new UIInput('button');\r\n        this.button.dom.title = text;\r\n        this.parent = parent;\r\n        this.dom.addEventListener('click', () => {\r\n\r\n            this.parent.select(this.dom.id);\r\n\r\n        });\r\n        this.add(this.button);\r\n    }\r\n}\r\n\r\n/**\r\n * UIListbox\r\n */\r\nclass UIListbox extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('select'));\r\n        \r\n        this.dom.multiple = true;\r\n\r\n        this.items = [];\r\n        this.listItems = [];\r\n        this.selectedIndex = -1;\r\n        this.selectedValue = null;\r\n\r\n        return this;\r\n    }\r\n\r\n    setItems(items) {\r\n\r\n        this.items = items;\r\n        this.dom.options.length = 0;\r\n\r\n        for (let i = 0; i < items.length; i++) {\r\n\r\n            this.setItem(items[i]);\r\n        }\r\n    }\r\n\r\n    selectIndex(index) {\r\n\r\n        this.selectValue(index);\r\n    }\r\n\r\n    selectValue(index) {\r\n\r\n        let value = null;\r\n\r\n        for (let i = 0; i < this.dom.options.length; i++) {\r\n\r\n            const option = this.dom.options[i];\r\n\r\n            if (index === i) {\r\n\r\n                option.selected = true;\r\n                option.className = 'selected';\r\n                value = parseInt(option.value);\r\n\r\n            } else {\r\n\r\n                option.selected = false;\r\n                option.className = '';\r\n            }\r\n        }\r\n\r\n        this.selectedValue = value;\r\n        this.selectedIndex = index;\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.selectedValue;\r\n    }\r\n\r\n    setItem(item) {\r\n\r\n        const option = document.createElement('option');\r\n        option.value = item.id;\r\n        option.text = item.type;\r\n        option.addEventListener('click', (event) => {\r\n\r\n            this.selectValue(event.target.index);\r\n\r\n        }, false);\r\n\r\n        this.dom.appendChild(option);\r\n        this.listItems.push(item);\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UITreeView\r\n */\r\nclass UITreeView extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('ul'));\r\n    }\r\n}\r\n\r\n/**\r\n * UITreeViewItem\r\n * @param {*} id\r\n * @param {*} link\r\n * @param {*} parent\r\n */\r\nclass UITreeViewItem extends UIElement {\r\n\r\n    constructor(id, link, parent) {\r\n\r\n        super(document.createElement('li'));\r\n        this.dom.id = id;\r\n        this.link = link;\r\n        this.parent = parent;\r\n        this.toggle = new UISpan().setClass('toggle-collapsed');\r\n        this.expander = new UIDiv().setId('expander');\r\n        this.expanded = false;\r\n        this.selected = false;\r\n        this.add([this.expander, this.link]);\r\n    }\r\n\r\n    setItems(subItems) {\r\n\r\n        this.add(subItems);\r\n        this.toggle.dom.onclick = () => {\r\n\r\n            if (this.expanded) {\r\n                this.collaps();\r\n            } else {\r\n                this.expand();\r\n            }\r\n            return false;\r\n        };\r\n        this.expander.add(this.toggle);\r\n\r\n        if (!this.expanded) {\r\n\r\n            const items = subItems.dom.getElementsByTagName('li');\r\n            for (let item of items) {\r\n                if (item.className === 'selected') {\r\n                    this.expand();\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    select() {\r\n\r\n        this.selected = true;\r\n        this.setClass('selected');\r\n    }\r\n\r\n    unselect() {\r\n\r\n        this.selected = false;\r\n        this.dom.removeAttribute('class');\r\n    }\r\n\r\n    expand() {\r\n\r\n        this.toggle.setClass('toggle-expanded');\r\n        this.dom.children[2].style.display = 'block';\r\n        this.expanded = true;\r\n    }\r\n\r\n    collaps() {\r\n\r\n        this.toggle.setClass('toggle-collapsed');\r\n        this.dom.children[2].style.display = 'none';\r\n        this.expanded = false;\r\n    }\r\n}\r\n\r\nexport {\r\n    UIElement,\r\n    UISpan,\r\n    UIDiv,\r\n    UIRow,\r\n    UIPanel,\r\n    UILabel,\r\n    UIText,\r\n    UILink,\r\n    UIInput,\r\n    UITextArea,\r\n    UISelect,\r\n    UICheckbox,\r\n    UIColor,\r\n    UINumber,\r\n    UIInteger,\r\n    UIBreak,\r\n    UIHorizontalRule,\r\n    UIButton,\r\n    UIProgress,\r\n    UITabbedPanel,\r\n    UITab,\r\n    UIListbox,\r\n    UITreeView,\r\n    UITreeViewItem\r\n};\r\n","import { UIPanel, UIText } from '../../ui.js';\r\n\r\nexport class MetadataPanel {\r\n\t\r\n\tconstructor(reader) {\r\n\t\t\r\n\t\tthis.panel = new UIPanel().setId('metadata');\r\n\t\tthis.title = new UIText().setId('book-title');\r\n\t\tthis.creator = new UIText().setId('book-creator');\r\n\t\tthis.separator = new UIText().setId('book-title-separator');\r\n\r\n\t\tthis.panel.add([this.title, this.separator, this.creator]);\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on('metadata', (meta) => {\r\n\r\n\t\t\tthis.init(meta);\r\n\t\t});\r\n\t}\r\n\r\n\tinit(meta) {\r\n\t\t\r\n\t\tdocument.title = meta.title + \" – \" + meta.creator;\r\n\r\n\t\tthis.title.setValue(meta.title);\r\n\t\tthis.creator.setValue(meta.creator);\r\n\t\tthis.separator.dom.style.display = 'inline-block';\r\n\t}\r\n}\r\n","import { UIPanel, UIDiv, UIInput } from '../ui.js';\r\nimport { MetadataPanel } from './panels/metadata_panel.js';\r\n\r\nexport class Toolbar {\r\n    \r\n    constructor(reader) {\r\n\r\n        const strings = reader.strings;\r\n\r\n        const container = new UIDiv().setId('toolbar');\r\n\r\n        const start = new UIPanel().setId('start');\r\n        const opener = new UIInput('button').setId('btn-s');\r\n        const openerStr = strings.get('toolbar/opener');\r\n        opener.dom.title = openerStr;\r\n        opener.dom.onclick = () => {\r\n\r\n            const isOpen = opener.dom.classList.length > 0;\r\n\r\n            reader.emit('sidebaropener', !isOpen);\r\n\r\n            if (!isOpen) {\r\n                opener.addClass('open');\r\n            } else {\r\n                opener.removeClass('open');\r\n            }\r\n        };\r\n\r\n        start.add(opener);\r\n\r\n        const center = new MetadataPanel(reader);\r\n\r\n        const end = new UIPanel().setId('end');\r\n        const upload = new UIInput('file').setId('btn-u');\r\n        const uploadStr = strings.get('toolbar/upload');\r\n        const storage = window.storage;\r\n        upload.dom.title = uploadStr;\r\n        upload.dom.accept = 'application/epub+zip';\r\n        upload.dom.addEventListener('change', function (e) {\r\n\r\n            if (e.target.files.length === 0)\r\n                return;\r\n\r\n            if (window.FileReader) {\r\n\r\n                const fr = new FileReader();\r\n                fr.onload = function (e) {\r\n                    storage.clear();\r\n                    storage.set(e.target.result, () => {\r\n                        reader.unload();\r\n                        reader.init(e.target.result, { restore: true });\r\n                    });\r\n                };\r\n                fr.readAsArrayBuffer(e.target.files[0]);\r\n                fr.onerror = function (e) {\r\n                    console.error(e);\r\n                };\r\n\r\n                if (window.location.href.includes(\"?bookPath=\")) {\r\n                    window.location.href = window.location.origin + window.location.pathname;\r\n                }\r\n\r\n            } else {\r\n                alert(strings.get('toolbar/upload/error'));\r\n            }\r\n        }, false);\r\n\r\n        end.add(upload);\r\n\r\n        const bookmark = new UIInput('button').setId('btn-b');\r\n        const bookmarkStr = strings.get('toolbar/bookmark');\r\n        bookmark.dom.title = bookmarkStr;\r\n        bookmark.dom.addEventListener('click', () => {\r\n\r\n            const cfi = reader.rendition.currentLocation().start.cfi;\r\n            reader.emit('bookmarked', reader.isBookmarked(cfi) === -1);\r\n        });\r\n\r\n        end.add(bookmark);\r\n\r\n        if (document.fullscreenEnabled) {\r\n            \r\n            const fullscreen = new UIInput('button').setId('btn-f');\r\n            const fullscreenStr = strings.get('toolbar/fullsceen');\r\n            fullscreen.dom.title = fullscreenStr;\r\n            fullscreen.dom.addEventListener('click', () => {\r\n                \r\n                this.toggleFullScreen();\r\n            });\r\n\r\n            document.addEventListener('keydown', (e) => {\r\n            \r\n                if (e.key === 'F11') {\r\n                    e.preventDefault();\r\n                    this.toggleFullScreen();\r\n                }\r\n            }, false);\r\n\r\n            document.addEventListener('fullscreenchange', (e) => {\r\n\r\n                const w = window.screen.width === e.path[2].innerWidth;\r\n                const h = window.screen.height === e.path[2].innerHeight;\r\n                \r\n                if (w && h) {\r\n                    fullscreen.addClass('resize-small');\r\n                } else {\r\n                    fullscreen.removeClass('resize-small');\r\n                }\r\n            }, false);\r\n\r\n            end.add(fullscreen);\r\n        }\r\n\r\n        container.add([start, center.panel, end]);\r\n        document.body.appendChild(container.dom);\r\n\r\n        //-- events --//\r\n\r\n        reader.on('relocated', (location) => {\r\n\r\n            const cfi = location.start.cfi;\r\n\r\n            if (reader.isBookmarked(cfi) === -1) {\r\n                bookmark.removeClass('bookmarked');\r\n            } else {\r\n                bookmark.addClass('bookmarked');\r\n            }\r\n        });\r\n\r\n        reader.on('bookmarked', (value) => {\r\n\r\n            if (value) {\r\n                bookmark.addClass('bookmarked');\r\n            } else {\r\n                bookmark.removeClass('bookmarked');\r\n            }\r\n        });\r\n    }\r\n\r\n    toggleFullScreen() {\r\n        \r\n        document.activeElement.blur();\r\n        \r\n        if (document.fullscreenElement === null) {\r\n            document.documentElement.requestFullscreen();\r\n        } else if (document.exitFullscreen) {\r\n            document.exitFullscreen();\r\n        }\r\n    }\r\n}\r\n","import { UIPanel, UITreeView, UITreeViewItem, UILink } from '../../ui.js';\r\n\r\nexport class TocPanel {\r\n    \r\n    constructor(reader) {\r\n        \r\n        this.panel = new UIPanel().setId('contents');\r\n        this.reader = reader;\r\n        this.selector = undefined; // save reference to selected tree item\r\n\r\n        //-- events --//\r\n\r\n        reader.on('navigation', (toc) => {\r\n\r\n            this.init(toc);\r\n        });\r\n    }\r\n\r\n    init(toc) {\r\n\r\n        this.panel.clear();\r\n        this.panel.add(this.generateToc(toc));\r\n    }\r\n\r\n    generateToc(toc, parent) {\r\n\r\n        const container = new UITreeView();\r\n\r\n        toc.forEach((chapter) => {\r\n\r\n            const link = new UILink(chapter.href, chapter.label);\r\n            const treeItem = new UITreeViewItem(chapter.id, link, parent);\r\n\r\n            link.dom.onclick = () => {\r\n\r\n                this.reader.rendition.display(chapter.href);\r\n                if (this.selector && this.selector !== treeItem) {\r\n                    this.selector.unselect();\r\n                }\r\n                treeItem.select();\r\n                this.selector = treeItem;\r\n                this.reader.emit('tocselected', chapter.id);\r\n                return false;\r\n            };\r\n\r\n            if (this.reader.settings.sectionId === chapter.id) {\r\n                treeItem.select();\r\n                this.selector = treeItem;\r\n            }\r\n\r\n            if (chapter.subitems && chapter.subitems.length > 0) {\r\n                \r\n                treeItem.setItems(this.generateToc(chapter.subitems, treeItem));\r\n            }\r\n\r\n            container.add(treeItem);\r\n        });\r\n\r\n        return container;\r\n    }\r\n}\r\n","import { UIPanel, UIRow, UIInput } from '../../ui.js';\r\n\r\nexport class BookmarksPanel {\r\n\r\n    constructor(reader) {\r\n        \r\n        const strings = reader.strings;\r\n\r\n        const ctrlRow = new UIRow();\r\n        const ctrlStr = [\r\n            strings.get('sidebar/bookmarks/add'),\r\n            strings.get('sidebar/bookmarks/remove'),\r\n            strings.get('sidebar/bookmarks/clear'),\r\n        ];\r\n        const btn_a = new UIInput('button', ctrlStr[0]).addClass('btn-start');\r\n        const btn_r = new UIInput('button', ctrlStr[1]).addClass('btn-medium');\r\n        const btn_c = new UIInput('button', ctrlStr[2]).addClass('btn-end');\r\n\r\n        btn_a.dom.onclick = () => {\r\n\r\n            reader.emit('bookmarked', true);\r\n            return false;\r\n        };\r\n\r\n        btn_r.dom.onclick = () => {\r\n\r\n            reader.emit('bookmarked', false);\r\n            return false;\r\n        };\r\n\r\n        btn_c.dom.onclick = () => {\r\n\r\n            this.clearBookmarks();\r\n            reader.emit('bookmarked', false);\r\n            return false;\r\n        };\r\n\r\n        ctrlRow.add([btn_a, btn_r, btn_c]);\r\n\r\n        this.reader = reader;\r\n\r\n        this.panel = new UIPanel().setId('bookmarks');\r\n        this.bookmarks = document.createElement('ul');\r\n        this.panel.add(ctrlRow);\r\n        this.panel.dom.appendChild(this.bookmarks);\r\n\r\n        const update = () => {\r\n\r\n            btn_r.dom.disabled = reader.settings.bookmarks.length === 0;\r\n            btn_c.dom.disabled = reader.settings.bookmarks.length === 0;\r\n        };\r\n\r\n        //-- events --//\r\n\r\n        reader.on ('bookready', () => {\r\n\r\n            reader.settings.bookmarks.forEach((cfi) => {\r\n                \r\n                const bookmark = this.createBookmarkItem(cfi);\r\n                this.bookmarks.appendChild(bookmark);\r\n            });\r\n\r\n            update();\r\n        });\r\n\r\n        reader.on('relocated', (location) => {\r\n\r\n            const cfi = location.start.cfi;\r\n            const val = reader.isBookmarked(cfi) === -1;\r\n            btn_a.dom.disabled = !val;\r\n            btn_r.dom.disabled = val;\r\n        });\r\n\r\n        reader.on('bookmarked', (value) => {\r\n\r\n            const cfi = reader.rendition.currentLocation().start.cfi;\r\n\r\n            if (value) {\r\n                this.addBookmark(cfi);\r\n                btn_a.dom.disabled = true;\r\n            } else {\r\n                this.removeBookmark(cfi);\r\n                btn_a.dom.disabled = false;\r\n            }\r\n\r\n            update();\r\n        });\r\n    }\r\n\r\n    addBookmark(cfi) {\r\n\r\n        if (this.reader.isBookmarked(cfi) > -1)\r\n            return;\r\n\r\n        const bookmark = this.createBookmarkItem(cfi);\r\n        this.bookmarks.appendChild(bookmark);\r\n        this.reader.settings.bookmarks.push(cfi);\r\n    }\r\n\r\n    removeBookmark(cfi) {\r\n\r\n        const index = this.reader.isBookmarked(cfi);\r\n        if (index === -1)\r\n            return;\r\n\r\n        this.bookmarks.removeChild(this.bookmarks.childNodes[index]);\r\n        this.reader.settings.bookmarks.splice(index, 1);\r\n    }\r\n\r\n    clearBookmarks() {\r\n\r\n        this.reader.settings.bookmarks = [];\r\n        while (this.bookmarks.hasChildNodes()) {\r\n            this.bookmarks.removeChild(this.bookmarks.lastChild);\r\n        }\r\n    }\r\n\r\n    createBookmarkItem(cfi) {\r\n\r\n        const item = document.createElement('li');\r\n        const link = document.createElement('a');\r\n\r\n        const book = this.reader.book;\r\n        const spineItem = book.spine.get(cfi);\r\n        \r\n        if (spineItem.index in book.navigation.toc) {\r\n            const tocItem = book.navigation.toc[spineItem.index];\r\n            item.id = tocItem.id;\r\n            link.textContent = tocItem.label;\r\n        } else {\r\n            link.textContent = cfi;\r\n        }\r\n\r\n        link.href = \"#\" + cfi;\r\n        link.onclick = () => {\r\n\r\n            this.reader.rendition.display(cfi);\r\n            return false;\r\n        };\r\n\r\n        item.appendChild(link);\r\n        return item;\r\n    }\r\n}\r\n","import { UIPanel, UIRow, UITextArea, UIInput } from '../../ui.js';\r\n\r\nexport class AnnotationsPanel {\r\n\r\n\tconstructor(reader) {\r\n\t\t\r\n\t\tconst strings = reader.strings;\r\n\r\n\t\tthis.panel = new UIPanel().setId('annotations');\r\n\t\tthis.notes = document.createElement('ul');\r\n\r\n\t\tconst textBox = new UITextArea();\r\n\t\ttextBox.dom.addEventListener('input', (e) => {\r\n\r\n\t\t\tif (isSelected() && e.target.value.length > 0) {\r\n\t\t\t\tbtn_a.dom.disabled = false;\r\n\t\t\t} else {\r\n\t\t\t\tbtn_a.dom.disabled = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.reader = reader;\r\n\t\tthis.range;\r\n\t\tthis.cfiRange;\r\n\r\n\t\tconst ctrlStr = [\r\n\t\t\tstrings.get('sidebar/annotations/add'),\r\n\t\t\tstrings.get('sidebar/annotations/clear')\r\n\t\t];\r\n\r\n\t\tconst textRow = new UIRow();\r\n\t\tconst ctrlRow = new UIRow();\r\n\r\n\t\tconst btn_a = new UIInput('button', ctrlStr[0]).addClass('btn-start');\r\n\t\tbtn_a.dom.disabled = true;\r\n\t\tbtn_a.dom.onclick = () => {\r\n\r\n\t\t\tconst note = {\r\n\t\t\t\tdate: new Date(),\r\n\t\t\t\ttext: textBox.getValue(),\r\n\t\t\t\thref: this.cfiRange,\r\n\t\t\t\tuuid: reader.uuid()\r\n\t\t\t};\r\n\r\n\t\t\treader.settings.annotations.push(note);\r\n\r\n\t\t\tthis.add(note);\r\n\r\n\t\t\ttextBox.setValue('');\r\n\t\t\tbtn_a.dom.disabled = true;\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\tconst btn_c = new UIInput('button', ctrlStr[1]).addClass('btn-end');\r\n\t\tbtn_c.dom.disabled = true;\r\n\t\tbtn_c.dom.onclick = () => {\r\n\r\n\t\t\tthis.clearNotes();\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\ttextRow.add(textBox);\r\n\t\tctrlRow.add([btn_a, btn_c]);\r\n\r\n\t\tthis.panel.add([textRow, ctrlRow]);\r\n\t\tthis.panel.dom.appendChild(this.notes);\r\n\r\n\t\tthis.update = () => {\r\n\r\n\t\t\tbtn_c.dom.disabled = reader.settings.annotations.length === 0;\r\n\t\t};\r\n\r\n\t\tconst isSelected = () => {\r\n\r\n\t\t\treturn this.range && this.range.startOffset !== this.range.endOffset;\r\n\t\t};\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on('bookready', () => {\r\n\r\n\t\t\treader.settings.annotations.forEach((note) => {\r\n\r\n\t\t\t\tthis.add(note);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treader.on('selected', (cfiRange, contents) => {\r\n\r\n\t\t\tthis.range = contents.range(cfiRange);\r\n\t\t\tthis.cfiRange = cfiRange;\r\n\r\n\t\t\tif (isSelected() && textBox.getValue().length > 0) {\r\n\t\t\t\tbtn_a.dom.disabled = false;\r\n\t\t\t} else {\r\n\t\t\t\tbtn_a.dom.disabled = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on('unselected', () => {\r\n\r\n\t\t\tbtn_a.dom.disabled = true;\r\n\t\t});\r\n\t}\r\n\r\n\tadd(note) {\r\n\r\n\t\tconst item = document.createElement('li');\r\n\t\tconst link = document.createElement('a');\r\n\t\tconst btnr = document.createElement('span');\r\n\t\tconst call = () => {};\r\n\t\t\r\n\t\tlink.href = \"#\" + note.href;\r\n\t\tlink.textContent = note.text;\r\n\t\tlink.onclick = () => {\r\n\r\n\t\t\tthis.reader.rendition.display(note.href);\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\titem.id = 'note-' + note.uuid;\r\n\t\titem.appendChild(link);\r\n\r\n\t\tbtnr.className = 'btn-remove';\r\n\t\tbtnr.onclick = () => {\r\n\t\t\t\r\n\t\t\tthis.remove(note);\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\t\r\n\t\titem.appendChild(btnr);\r\n\r\n\t\tthis.notes.appendChild(item);\r\n\t\tthis.reader.rendition.annotations.add(\r\n\t\t\t\"highlight\", note.href, {}, call, \"note-highlight\", {});\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tremove(note) {\r\n\r\n\t\tconst index = this.reader.settings.annotations.indexOf(note);\r\n\t\tif (index === -1)\r\n\t\t\treturn;\r\n\r\n\t\tthis.notes.removeChild(this.notes.childNodes[index]);\r\n\t\tthis.reader.settings.annotations.splice(index, 1);\r\n\t\tthis.reader.rendition.annotations.remove(note.href, \"highlight\");\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tclearNotes() {\r\n\r\n\t\tconst len = this.reader.settings.annotations.length;\r\n\t\tfor(let i = 0; i < len; i++) {\r\n\r\n\t\t\tthis.remove(this.reader.settings.annotations[i]);\r\n\t\t}\r\n\t}\r\n}\r\n","import { UIPanel, UIRow, UIInput } from '../../ui.js';\r\n\r\nexport class SearchPanel {\r\n\r\n    constructor(reader) {\r\n\r\n        const strings = reader.strings;\r\n        \r\n        this.panel = new UIPanel().setId('search');\r\n        this.query = undefined;\r\n        this.pages = [];\r\n        this.searchBox = new UIInput('search');\r\n        this.searchBox.dom.placeholder = strings.get('sidebar/search/placeholder');\r\n        this.searchBox.dom.addEventListener('search', () => {\r\n\r\n            const value = this.searchBox.getValue();\r\n            \r\n            if (value.length === 0) {\r\n                this.clear();\r\n                this.query = value;\r\n            } else if (this.query !== value) {\r\n                this.clear();\r\n                this.query = value;\r\n                this.doSearch(value).then(results => {\r\n\r\n                    results.forEach(item => {\r\n                        this.set(item);\r\n                    });\r\n                });\r\n            }\r\n        });\r\n        this.searchResult = document.createElement('ul');\r\n\r\n        const ctrlRow = new UIRow();\r\n        ctrlRow.add(this.searchBox);\r\n\r\n        this.panel.add(ctrlRow);\r\n        this.panel.dom.appendChild(this.searchResult);\r\n        this.reader = reader;\r\n        //\r\n        // improvement of the highlighting of keywords is required...\r\n        //\r\n    }\r\n\r\n    /**\r\n     * Searching the entire book\r\n     * @param {*} q Query keyword\r\n     * @returns The search result array.\r\n     */\r\n    async doSearch(q) {\r\n\r\n        const book = this.reader.book;\r\n        const results = await Promise.all(\r\n            book.spine.spineItems.map(item => item.load(book.load.bind(book))\r\n            .then(item.find.bind(item, q)).finally(item.unload.bind(item))));\r\n        return await Promise.resolve([].concat.apply([], results));\r\n    }\r\n\r\n    set(data) {\r\n\r\n        const item = document.createElement('li');\r\n        const link = document.createElement('a');\r\n\r\n        link.href = \"#\" + data.cfi;\r\n        link.textContent = data.excerpt;\r\n        link.onclick = () => {\r\n\r\n            this.reader.rendition.display(data.cfi);\r\n            return false;\r\n        };\r\n\r\n        item.appendChild(link);\r\n        this.searchResult.appendChild(item);\r\n    }\r\n\r\n    clear() {\r\n\r\n        while (this.searchResult.hasChildNodes()) {\r\n            this.searchResult.removeChild(this.searchResult.lastChild);\r\n        }\r\n    }\r\n}","import { UIPanel, UIRow, UISelect, UIInput, UILabel, UIInteger } from '../../ui.js';\r\n\r\nexport class SettingsPanel {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tconst strings = reader.strings;\r\n\r\n\t\tthis.panel = new UIPanel().setId('settings');\r\n\r\n\t\tconst languageStr = strings.get('sidebar/settings/language');\r\n\t\tconst languageRow = new UIRow();\r\n\t\tconst language = new UISelect().setOptions({ en: 'English', fr: 'French', ja: 'Japanese', ru: 'Russian' });\r\n\t\tlanguage.dom.addEventListener('change', (e) => {\r\n\r\n\t\t\treader.settings.language = e.target.value;\r\n\t\t});\r\n\r\n\t\tlanguageRow.add(new UILabel(languageStr));\r\n\t\tlanguageRow.add(language);\r\n\r\n\t\tconst fontSizeStr = strings.get('sidebar/settings/fontsize');\r\n\t\tconst fontSizeRow = new UIRow();\r\n\t\tconst fontSize = new UIInteger(100, 1);\r\n\t\tfontSize.dom.addEventListener('change', (e) => {\r\n\r\n\t\t\treader.emit('fontresize', e.target.value);\r\n\t\t});\r\n\r\n\t\tfontSizeRow.add(new UILabel(fontSizeStr));\r\n\t\tfontSizeRow.add(fontSize);\r\n\r\n\t\tconst reflowTextStr = strings.get('sidabar/settings/reflowtext');\r\n\t\tconst reflowTextRow = new UIRow();\r\n\t\tconst reflowText = new UIInput('checkbox', false, reflowTextStr[1]);\r\n\t\treflowText.setId('reflowtext');\r\n\t\treflowText.dom.addEventListener('click', (e) => {\r\n\r\n\t\t\treader.settings.reflowText = e.target.checked;\r\n\t\t\treader.rendition.resize();\r\n\t\t});\r\n\r\n\t\treflowTextRow.add(new UILabel(reflowTextStr[0], 'reflowtext'));\r\n\t\treflowTextRow.add(reflowText);\r\n\r\n\t\tconst paginationStr = strings.get('sidebar/settings/pagination');\r\n\t\tconst paginationRow = new UIRow();\r\n\t\tconst pagination = new UIInput('checkbox', false, paginationStr[1]);\r\n\t\tpagination.setId('pagination');\r\n\t\tpagination.dom.addEventListener('click', (e) => {\r\n\r\n\t\t\treader.settings.pagination = e.target.checked;\r\n\t\t\treader.generatePagination(); // not implemented\r\n\t\t});\r\n\r\n\t\tpaginationRow.add(new UILabel(paginationStr[0], 'pagination'));\r\n\t\tpaginationRow.add(pagination);\r\n\r\n\t\tthis.panel.add([\r\n\t\t\tlanguageRow,\r\n\t\t\tfontSizeRow,\r\n\t\t\t//reflowTextRow,\r\n\t\t\t//paginationRow\r\n\t\t]);\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on('bookready', () => {\r\n\r\n\t\t\tlanguage.setValue(reader.settings.language);\r\n\t\t});\r\n\r\n\t\treader.on('fontresize', (value) => {\r\n\r\n\t\t\tif (fontSize.getValue() !== value) {\r\n\t\t\t\tfontSize.setValue(value);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","import { UITabbedPanel } from '../ui.js';\r\nimport { TocPanel } from './panels/toc_panel.js';\r\nimport { BookmarksPanel } from './panels/bookmarks_panel.js';\r\nimport { AnnotationsPanel } from './panels/annotations_panel.js';\r\nimport { SearchPanel } from './panels/search_panel.js';\r\nimport { SettingsPanel } from './panels/settings_panel.js';\r\n\r\nexport class Sidebar {\r\n    \r\n    constructor(reader) {\r\n        \r\n        const strings = reader.strings;\r\n        const tabs = [\r\n            strings.get('sidebar/contents'),\r\n            strings.get('sidebar/bookmarks'),\r\n            strings.get('sidebar/annotations'),\r\n            strings.get('sidebar/search'),\r\n            strings.get('sidebar/settings')\r\n        ];\r\n\r\n        this.toc = new TocPanel(reader);\r\n        this.bookmarks = new BookmarksPanel(reader);\r\n        this.annotations = new AnnotationsPanel(reader);\r\n        this.search = new SearchPanel(reader);\r\n        this.settings = new SettingsPanel(reader);\r\n\r\n        this.container = new UITabbedPanel('vertical').setId('sidebar');\r\n\r\n        this.container.addTab('tab-t', tabs[0], this.toc.panel);\r\n        this.container.addTab('tab-b', tabs[1], this.bookmarks.panel);\r\n        this.container.addTab('tab-n', tabs[2], this.annotations.panel);\r\n        this.container.addTab('tab-s', tabs[3], this.search.panel);\r\n        this.container.addTab('tab-c', tabs[4], this.settings.panel);\r\n\r\n        this.container.select('tab-t');\r\n\r\n        document.body.appendChild(this.container.dom);\r\n    }\r\n}","import { UIDiv, UILabel } from '../ui.js';\r\n\r\nexport class Content {\r\n\r\n    constructor(reader) {\r\n        \r\n        this.main = new UIDiv().setId('content');\r\n        this.main.dom.addEventListener('transitionend', (e) => {\r\n\r\n            if (reader.settings.sidebarReflow) {\r\n                reader.rendition.resize();\r\n            }\r\n        });\r\n\r\n        const prev = new UIDiv().setId('prev').setClass('arrow');\r\n        prev.dom.onclick = (e) => {\r\n\r\n            reader.emit('prev');\r\n            e.preventDefault();\r\n        };\r\n        prev.add(new UILabel('<'));\r\n\r\n        const next = new UIDiv().setId('next').setClass('arrow');\r\n        next.dom.onclick = (e) => {\r\n            \r\n            reader.emit('next');\r\n            e.preventDefault();\r\n        };\r\n        next.add(new UILabel('>'));\r\n\r\n        const viewer  = new UIDiv().setId('viewer');\r\n        const divider = new UIDiv().setId('divider');\r\n        const loader  = new UIDiv().setId('loader');\r\n\r\n        const showDivider = () => {\r\n            divider.dom.style.display = 'block';\r\n        };\r\n\r\n        const hideDivider = () => {\r\n            divider.dom.style.display = 'none';\r\n        };\r\n\r\n        const showLoader = () => {\r\n            loader.dom.style.display = 'block';\r\n            hideDivider();\r\n        };\r\n\r\n        const hideLoader = () => {\r\n            loader.dom.style.display = 'none';\r\n\r\n            //-- If the book is using spreads, show the divider\r\n            if(reader.book.settings.spreads) {\r\n                showDivider();\r\n            }\r\n        };\r\n\r\n        this.main.add([prev, viewer, next, divider, loader]);\r\n\r\n        this.reader = reader;\r\n        \r\n        document.body.appendChild(this.main.dom);\r\n\r\n        //-- events --//\r\n\r\n        reader.on('bookloaded', () => {\r\n\r\n            hideLoader();\r\n        });\r\n\r\n        reader.on('sidebaropener', (value) => {\r\n            \r\n            if (value) {\r\n                this.slideOut();\r\n            } else {\r\n                this.slideIn();\r\n            }\r\n        });\r\n\r\n        reader.on('layout', (props) => {\r\n\r\n            if (props.spread === true && props.width > props.spreadWidth) {\r\n                showDivider();\r\n            } else {\r\n                hideDivider();\r\n            }\r\n        });\r\n\r\n        reader.on('relocated', (location) => {\r\n\r\n            if (location.atStart) {\r\n                prev.addClass('disabled');\r\n            } else {\r\n                prev.removeClass('disabled');\r\n            }\r\n\r\n            if (location.atEnd) {\r\n                next.addClass('disabled');\r\n            } else {\r\n                next.removeClass('disabled');\r\n            }\r\n        });\r\n\r\n        reader.on('prev', () => {\r\n\r\n            prev.addClass('active');\r\n            setTimeout(() => { prev.removeClass('active'); }, 100);\r\n        });\r\n\r\n        reader.on('next', () => {\r\n\r\n            next.addClass('active');\r\n            setTimeout(() => { next.removeClass('active'); }, 100);\r\n        });\r\n\r\n        reader.on('viewercleanup', () => {\r\n\r\n            viewer.clear();\r\n        });\r\n    }\r\n\r\n    slideIn() {\r\n\r\n        //var currentPosition = rendition.currentLocation().start.cfi;\r\n        if (this.reader.settings.sidebarReflow) {\r\n            //this.main.removeClass('single');\r\n        } else {\r\n            //this.main.removeClass('closed');\r\n        }\r\n\r\n        this.main.removeClass('single');\r\n        this.main.removeClass('closed');\r\n    }\r\n\r\n    slideOut() {\r\n        /*\r\n        var location = rendition.currentLocation();\r\n        if (!location) {\r\n            return;\r\n        }\r\n        var currentPosition = location.start.cfi;\r\n        */\r\n        if (this.reader.settings.sidebarReflow) {\r\n            this.main.addClass('single');\r\n        } else {\r\n            this.main.addClass('closed');\r\n        }\r\n    }\r\n}","export class Strings {\r\n\r\n    constructor(reader) {\r\n\r\n        this.language = reader.settings.language || 'en';\r\n        this.values = {\r\n            en: {\r\n                'toolbar/opener': 'Sidebar',\r\n                'toolbar/upload': 'Upload book',\r\n                'toolbar/upload/error': 'Your browser does not support the required features.\\nPlease use a modern browser such as Google Chrome, or Mozilla Firefox.',\r\n                'toolbar/bookmark': 'Add this page to bookmarks',\r\n                'toolbar/fullsceen': 'Fullscreen',\r\n\r\n                'sidebar/contents': 'Contents',\r\n                'sidebar/bookmarks': 'Bookmarks',\r\n                'sidebar/bookmarks/add': 'Add',\r\n                'sidebar/bookmarks/remove': 'Remove',\r\n                'sidebar/bookmarks/clear': 'Clear',\r\n                'sidebar/annotations': 'Annotations',\r\n                'sidebar/annotations/add': 'Add',\r\n                'sidebar/annotations/clear': 'Clear',\r\n                'sidebar/annotations/anchor': 'Anchor',\r\n                'sidebar/annotations/cancel': 'Cancel',\r\n                'sidebar/search': 'Search',\r\n                'sidebar/search/placeholder': 'search',\r\n                'sidebar/settings': 'Settings',\r\n                'sidebar/settings/language': 'Language',\r\n                'sidebar/settings/fontsize': 'Font size (%)',\r\n                'sidabar/settings/reflowtext': ['Reflow text', 'Reflow text when sidebars are open'],\r\n                'sidebar/settings/pagination': ['Pagination', 'Generate pagination']\r\n            },\r\n            fr: {\r\n                'toolbar/opener': 'Barre latérale',\r\n                'toolbar/upload': 'Ouvrir un livre local',\r\n                'toolbar/upload/error': 'Votre navigateur ne prend pas en charge les fonctions nécessaires.\\nVeuillez utiliser un navigateur moderne tel que Google Chrome ou Mozilla Firefox.',\r\n                'toolbar/bookmark': 'Insérer un marque page ici',\r\n                'toolbar/fullsceen': 'Plein écran',\r\n\r\n                'sidebar/contents': 'Sommaire',\r\n                'sidebar/bookmarks': 'Marque-pages',\r\n                'sidebar/bookmarks/add': 'Ajouter',\r\n                'sidebar/bookmarks/remove': 'Retirer',\r\n                'sidebar/bookmarks/clear': 'Tout enlever',\r\n                'sidebar/annotations': 'Annotations',\r\n                'sidebar/annotations/add': 'Ajouter',\r\n                'sidebar/annotations/clear': 'Tout enlever',\r\n                'sidebar/annotations/anchor': 'Ancre',\r\n                'sidebar/annotations/cancel': 'Annuler',\r\n                'sidebar/search': 'Rechercher',\r\n                'sidebar/search/placeholder': 'rechercher',\r\n                'sidebar/settings': 'Réglages',\r\n                'sidebar/settings/language': 'Langue',\r\n                'sidebar/settings/fontsize': '???',\r\n                'sidabar/settings/reflowtext': ['Réagencer', 'Réagencer les lignes lorsque le panneau latéral est ouvert'],\r\n                'sidebar/settings/pagination': ['Pagination', 'Établir une pagination']\r\n            },\r\n            ja: {\r\n                'toolbar/opener': 'サイドバー',\r\n                'toolbar/upload': '本を開く',\r\n                'toolbar/upload/error': 'ご利用のブラウザは必要な機能をサポートしていません。\\nGoogle Chrome、Mozilla Firefox、その他のモダンなブラウザでご利用ください。',\r\n                'toolbar/bookmark': 'このページに栞を設定する',\r\n                'toolbar/fullsceen': 'フルスクリーン',\r\n\r\n                'sidebar/contents': '目次',\r\n                'sidebar/bookmarks': '栞',\r\n                'sidebar/bookmarks/add': '追加',\r\n                'sidebar/bookmarks/remove': '削除',\r\n                'sidebar/bookmarks/clear': 'クリア',\r\n                'sidebar/annotations': '注釈',\r\n                'sidebar/annotations/add': '追加',\r\n                'sidebar/annotations/clear': 'クリア',\r\n                'sidebar/annotations/anchor': 'アンカー',\r\n                'sidebar/annotations/cancel': 'キャンセル',\r\n                'sidebar/search': '検索',\r\n                'sidebar/search/placeholder': '検索',\r\n                'sidebar/settings': '設定',\r\n                'sidebar/settings/language': '表示言語',\r\n                'sidebar/settings/fontsize': '???',\r\n                'sidabar/settings/reflowtext': ['再配置', 'サイドバーを開いた時に、テキストを再配置します。'],\r\n                'sidebar/settings/pagination': ['ページネーション', 'ページネーションを生成します。']\r\n            },\r\n            ru: {\r\n                'toolbar/opener': 'Боковая панель',\r\n                'toolbar/upload': 'Загрузить книгу',\r\n                'toolbar/upload/error': 'Ваш браузер не поддерживает необходимые функции.\\nПожалуйста, используйте современный браузер, такой как Google Chrome или Mozilla Firefox.',\r\n                'toolbar/bookmark': 'Добавить эту страницу в закладки',\r\n                'toolbar/fullsceen': 'Полноэкранный режим',\r\n\r\n                'sidebar/contents': 'Содержание',\r\n                'sidebar/bookmarks': 'Закладки',\r\n                'sidebar/bookmarks/add': 'Добавить',\r\n                'sidebar/bookmarks/remove': 'Удалить',\r\n                'sidebar/bookmarks/clear': 'Очистить',\r\n                'sidebar/annotations': 'Аннотации',\r\n                'sidebar/annotations/add': 'Добавить',\r\n                'sidebar/annotations/clear': 'Очистить',\r\n                'sidebar/annotations/anchor': 'Метка',\r\n                'sidebar/annotations/cancel': 'Отмена',\r\n                'sidebar/search': 'Поиск',\r\n                'sidebar/search/placeholder': 'поиск...',\r\n                'sidebar/settings': 'Настройки',\r\n                'sidebar/settings/language': 'Язык',\r\n                'sidebar/settings/fontsize': 'Размер шрифта',\r\n                'sidabar/settings/reflowtext': ['Перекомпоновать текст', 'Перекомпоновать текст при открытых боковых панелях'],\r\n                'sidebar/settings/pagination': ['Нумерация страниц', 'Генерировать нумерацию страниц']\r\n            }\r\n        };\r\n    }\r\n\r\n    get(key) { return this.values[this.language][key] || '???'; }\r\n}\r\n","import EventEmitter from \"event-emitter\";\r\n\r\nimport { Toolbar } from './controllers/toolbar.js';\r\nimport { Sidebar } from './controllers/sidebar.js';\r\nimport { Content } from './controllers/content.js';\r\nimport { Strings } from './strings.js';\r\n\r\nexport class Reader {\r\n\r\n    constructor(bookPath, _options) {\r\n\r\n        this.settings = undefined;\r\n        this.cfgInit(bookPath, _options);\r\n\r\n        this.strings = new Strings(this);\r\n        this.toolbar = new Toolbar(this);\r\n        this.sidebar = new Sidebar(this);\r\n        this.content = new Content(this);\r\n\r\n        this.book = undefined;\r\n        this.rendition = undefined;\r\n        this.displayed = undefined;\r\n\r\n        this.init();\r\n\r\n        window.addEventListener('beforeunload', this.unload.bind(this), false);\r\n        window.addEventListener('hashchange', this.hashChanged.bind(this), false);\r\n        window.addEventListener('keydown', this.keyboardHandler.bind(this), false);\r\n        window.addEventListener('wheel', (e) => {\r\n            if (e.ctrlKey) {\r\n                e.preventDefault();\r\n            }\r\n        }, { passive: false });\r\n    }\r\n\r\n    /**\r\n     * Initialize book.\r\n     * @param {*} bookPath \r\n     * @param {*} _options \r\n     */\r\n    init(bookPath, _options) {\r\n\r\n        this.emit('viewercleanup');\r\n        \r\n        if (arguments.length > 0) {\r\n\r\n            this.cfgInit(bookPath, _options);\r\n        }\r\n\r\n        this.book = ePub(this.settings.bookPath);\r\n        this.rendition = this.book.renderTo('viewer', {\r\n            width: '100%',\r\n            height: '100%'\r\n        });\r\n\r\n        const cfi = this.settings.previousLocationCfi;\r\n        if (cfi) {\r\n            this.displayed = this.rendition.display(cfi);\r\n        } else {\r\n            this.displayed = this.rendition.display();\r\n        }\r\n\r\n        this.displayed.then((renderer) => {\r\n            this.emit('renderered', renderer);\r\n        });\r\n\r\n        this.book.ready.then(function () {\r\n            if (this.settings.pagination) {\r\n                this.generatePagination();\r\n            }\r\n            this.emit('bookready');\r\n            this.emit('fontresize', parseInt(this.settings.styles.fontSize));\r\n        }.bind(this)).then(function () {\r\n            this.emit('bookloaded');\r\n        }.bind(this));\r\n\r\n        this.book.loaded.metadata.then((meta) => {\r\n            this.emit('metadata', meta);\r\n        });\r\n\r\n        this.book.loaded.navigation.then((toc) => {\r\n            this.emit('navigation', toc);\r\n        });\r\n\r\n        this.rendition.on('click', (e) => {\r\n            const selection = e.view.document.getSelection();\r\n            const range = selection.getRangeAt(0);\r\n            if (range.startOffset === range.endOffset) {\r\n                this.emit('unselected');\r\n            }\r\n        });\r\n\r\n        this.rendition.on('layout', (props) => {\r\n            this.emit('layout', props);\r\n        });\r\n\r\n        this.rendition.on('selected', (cfiRange, contents) => {\r\n            this.setLocation(cfiRange);\r\n            this.emit('selected', cfiRange, contents);\r\n        });\r\n\r\n        this.rendition.on('relocated', (location) => {\r\n            this.setLocation(location.start.cfi);\r\n            this.emit('relocated', location);\r\n        });\r\n\r\n        this.on('fontresize', (value) => {\r\n            const fontSize = value + \"%\";\r\n            this.settings.styles.fontSize = fontSize;\r\n            this.rendition.themes.fontSize(fontSize);\r\n        });\r\n\r\n        this.on('prev', () => {\r\n            if (this.book.package.metadata.direction === 'rtl') {\r\n                this.rendition.next();\r\n            } else {\r\n                this.rendition.prev();\r\n            }\r\n        });\r\n\r\n        this.on('next', () => {\r\n            if (this.book.package.metadata.direction === 'rtl') {\r\n                this.rendition.prev();\r\n            } else {\r\n                this.rendition.next();\r\n            }\r\n        });\r\n\r\n        this.on('tocselected', (sectionId) => {\r\n            this.settings.sectionId = sectionId;\r\n        });\r\n    }\r\n\r\n    /* ------------------------------- Common ------------------------------- */\r\n\r\n    defaults(obj) {\r\n\r\n        for (let i = 1, length = arguments.length; i < length; i++) {\r\n            const source = arguments[i];\r\n            for (let prop in source) {\r\n                if (obj[prop] === void 0)\r\n                    obj[prop] = source[prop];\r\n            }\r\n        }\r\n        return obj;\r\n    }\r\n\r\n    uuid() {\r\n\r\n        let d = new Date().getTime();\r\n        const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\r\n            let r = (d + Math.random() * 16) % 16 | 0;\r\n            d = Math.floor(d / 16);\r\n            return (c === 'x' ? r : (r & 0x7 | 0x8)).toString(16);\r\n        });\r\n        return uuid;\r\n    }\r\n\r\n    /* ------------------------------ Bookmarks ----------------------------- */\r\n\r\n    /**\r\n     * Verifying the current page in bookmarks.\r\n     * @param {*} cfi \r\n     * @returns The index of the bookmark if it exists, or -1 otherwise.\r\n     */\r\n    isBookmarked(cfi) {\r\n\r\n        return this.settings.bookmarks.indexOf(cfi);\r\n    }\r\n\r\n    /* ----------------------------- Annotations ---------------------------- */\r\n\r\n    isAnnotated(note) {\r\n\r\n        return this.settings.annotations.indexOf(note);\r\n    }\r\n\r\n    /* ------------------------------ Settings ------------------------------ */\r\n\r\n    /**\r\n     * Initialize book settings.\r\n     * @param {*} bookPath\r\n     * @param {*} _options\r\n     */\r\n    cfgInit(bookPath, _options) {\r\n\r\n        this.settings = this.defaults(_options || {}, {\r\n            bookKey: this.getBookKey(bookPath),\r\n            bookPath: bookPath,\r\n            restore: false,\r\n            history: true,\r\n            reload: false, // ??\r\n            bookmarks: undefined,\r\n            annotations: undefined,\r\n            contained: undefined,\r\n            sectionId: undefined,\r\n            styles: undefined,\r\n            reflowText: false, // ??\r\n            pagination: false, // ??\r\n            language: undefined\r\n        });\r\n\r\n        if (this.settings.restore && this.isSaved()) {\r\n            this.applySavedSettings();\r\n        }\r\n\r\n        if (this.settings.bookmarks === undefined) {\r\n            this.settings.bookmarks = [];\r\n        }\r\n\r\n        if (this.settings.annotations === undefined) {\r\n            this.settings.annotations = [];\r\n        }\r\n\r\n        if (this.settings.styles === undefined) {\r\n            this.settings.styles = { fontSize: '100%' };\r\n        }\r\n\r\n        if (this.settings.language === undefined) {\r\n            this.settings.language = 'en';\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get book key.\r\n     * @param {*} identifier (url | blob)\r\n     * @returns Book key (MD5).\r\n     */\r\n    getBookKey(identifier) {\r\n\r\n        return 'epubjs-reader:' + md5(identifier);\r\n    }\r\n    \r\n    /**\r\n     * Set book key in settings.\r\n     * @param {*} identifier (url | blob)\r\n     * @returns Current book key.\r\n     */\r\n    setBookKey(identifier) {\r\n\r\n        if (this.settings.bookKey === undefined) {\r\n            this.settings.bookKey = this.getBookKey(identifier);\r\n        }\r\n        return this.settings.bookKey;\r\n    }\r\n\r\n    /**\r\n     * Checks if the book setting can be retrieved from localStorage.\r\n     * @returns true if the book key exists, or false otherwise.\r\n     */\r\n    isSaved() {\r\n\r\n        if (!localStorage)\r\n            return false;\r\n        \r\n        return localStorage.getItem(this.settings.bookKey) !== null;\r\n    }\r\n\r\n    /**\r\n     * Removing the current book settings from local storage.\r\n     * @returns true if the book settings were deleted successfully, or false \r\n     * otherwise.\r\n     */\r\n    removeSavedSettings() {\r\n\r\n        if (!this.isSaved())\r\n            return false;\r\n\r\n        localStorage.removeItem(this.settings.bookKey);\r\n        return true;\r\n    }\r\n\r\n    applySavedSettings() {\r\n\r\n        if (!localStorage)\r\n            return false;\r\n\r\n        let stored;\r\n        try {\r\n            stored = JSON.parse(localStorage.getItem(this.settings.bookKey));\r\n        } catch (e) { // parsing error of localStorage\r\n            console.exception(e);\r\n        }\r\n\r\n        if (stored) {\r\n            // Merge styles\r\n            if (stored.styles) {\r\n                this.settings.styles = this.defaults(this.settings.styles || {},\r\n                    stored.styles);\r\n            }\r\n            // Merge the rest\r\n            this.settings = this.defaults(this.settings, stored);\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Saving the current book settings in local storage.\r\n     * @returns \r\n     */\r\n    saveSettings() {\r\n\r\n        if (this.book) {\r\n            \r\n            const curLocation = this.rendition.currentLocation();\r\n            if (curLocation.start) {\r\n                this.settings.previousLocationCfi = curLocation.start.cfi;\r\n            }\r\n        }\r\n\r\n        if (!localStorage)\r\n            return false;\r\n\r\n        localStorage.setItem(this.settings.bookKey, JSON.stringify(this.settings));\r\n        return true;\r\n    }\r\n\r\n    unload() {\r\n        \r\n        if (this.settings.restore && localStorage) {\r\n            this.saveSettings();\r\n        }\r\n    }\r\n\r\n    hashChanged() {\r\n\r\n        const hash = window.location.hash.slice(1);\r\n        this.rendition.display(hash);\r\n    }\r\n\r\n    setLocation(cfi) {\r\n\r\n        const baseUrl = this.book.archived ? undefined : this.book.url;\r\n        const url = new URL(window.location, baseUrl);\r\n        url.hash = \"#\" + cfi;\r\n\r\n        // Update the History Location\r\n        if (this.settings.history && window.location.hash !== url.hash) {\r\n            // Add CFI fragment to the history\r\n            window.history.pushState({}, \"\", url);\r\n            this.currentLocationCfi = cfi;\r\n        }\r\n    }\r\n\r\n    generatePagination() {\r\n        //\r\n        // no implemented\r\n        //\r\n        //const rect = this.content.viewer.getRect();\r\n        //this.book.generatePagination(rect.width, rect.height);\r\n    }\r\n\r\n    keyboardHandler(e) {\r\n\r\n        const MOD = (e.ctrlKey || e.metaKey);\r\n\r\n        if (MOD) {\r\n\r\n            const step = 2;\r\n            let value = parseInt(this.settings.styles.fontSize);\r\n\r\n            switch (e.key) {\r\n\r\n                case '=':\r\n                    e.preventDefault();\r\n                    value += step;\r\n                    this.emit('fontresize', value);\r\n                    break;\r\n                case '-':\r\n                    e.preventDefault();\r\n                    value -= step;\r\n                    this.emit('fontresize', value);\r\n                    break;\r\n                case '0':\r\n                    e.preventDefault();\r\n                    value = 100;\r\n                    this.emit('fontresize', value);\r\n                    break;\r\n            }\r\n        } else {\r\n\r\n            switch (e.key) {\r\n                case 'ArrowLeft':\r\n                    this.emit('prev');\r\n                    e.preventDefault();\r\n                    break;\r\n                case 'ArrowRight':\r\n                    this.emit('next');\r\n                    e.preventDefault();\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nEventEmitter(Reader.prototype);\r\n","export class Storage {\r\n\r\n\tconstructor() {\r\n\t\t\r\n\t\tthis.name = 'epubjs-reader';\r\n\t\tthis.version = 1.0;\r\n\t\tthis.database;\r\n\t\tthis.indexedDB = window.indexedDB || \r\n\t\t\t\t\t\t window.webkitIndexedDB || \r\n\t\t\t\t\t\t window.mozIndexedDB ||\r\n\t\t\t\t\t\t window.OIndexedDB ||\r\n\t\t\t\t\t\t window.msIndexedDB;\r\n\t\t\r\n\t\tif (this.indexedDB === undefined) {\r\n\r\n\t\t\talert('The IndexedDB API not available in your browser.');\r\n\t\t}\r\n\t}\r\n\r\n\tinit(callback) {\r\n\r\n\t\tif (this.indexedDB === undefined) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst scope = this;\r\n\t\tconst request = indexedDB.open(this.name, this.version);\r\n\t\trequest.onupgradeneeded = function (event) {\r\n\r\n\t\t\tconst db = event.target.result;\r\n\t\t\tif (db.objectStoreNames.contains('entries') === false) {\r\n\r\n\t\t\t\tdb.createObjectStore(\"entries\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\trequest.onsuccess = function (event) {\r\n\r\n\t\t\tscope.database = event.target.result;\r\n\t\t\tscope.database.onerror = function (event) {\r\n\r\n\t\t\t\tconsole.error('IndexedDB', event);\r\n\t\t\t};\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\trequest.onerror = function (event) {\r\n\r\n\t\t\tconsole.error('IndexedDB', event);\r\n\t\t};\r\n\t}\r\n\r\n\tget(callback) {\r\n\r\n\t\tif (this.database === undefined) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst transaction = this.database.transaction(['entries'], 'readwrite');\r\n\t\tconst objectStore = transaction.objectStore('entries');\r\n\t\tconst request = objectStore.get(0);\r\n\t\trequest.onsuccess = function (event) {\r\n\r\n\t\t\tcallback(event.target.result);\r\n\t\t\tconsole.log('storage.get');\r\n\t\t};\r\n\t}\r\n\r\n\tset(data, callback) {\r\n\t\t\r\n\t\tif (this.database === undefined) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst transaction = this.database.transaction(['entries'], 'readwrite');\r\n\t\tconst objectStore = transaction.objectStore('entries');\r\n\t\tconst request = objectStore.put(data, 0);\r\n\t\trequest.onsuccess = function () {\r\n\r\n\t\t\tcallback();\r\n\t\t\tconsole.log('storage.set');\r\n\t\t};\r\n\t}\r\n\r\n\tclear() {\r\n\r\n\t\tif (this.database === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tconst transaction = this.database.transaction(['entries'], 'readwrite');\r\n\t\tconst objectStore = transaction.objectStore('entries');\r\n\t\tconst request = objectStore.clear();\r\n\t\trequest.onsuccess = function () {\r\n\r\n\t\t\tconsole.log('storage.clear');\r\n\t\t};\r\n\t}\r\n}\r\n","import { Reader } from './reader.js';\r\nimport { Storage } from './storage.js';\r\n\r\n\"use strict\";\r\n\r\nwindow.onload = function () {\r\n\r\n\tconst storage = new Storage();\r\n\tconst url = new URL(window.location);\r\n\tconst path = url.search.length > 0 \r\n\t\t? url.searchParams.get(\"bookPath\") \r\n\t\t: \"https://s3.amazonaws.com/moby-dick/\";\r\n\r\n\tstorage.init(function () {\r\n\r\n\t\tstorage.get(function (data) {\r\n\r\n\t\t\tif (data !== undefined && url.search.length === 0) {\r\n\r\n\t\t\t\twindow.reader = new Reader(data, { restore: true });\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\twindow.reader = new Reader(path, { restore: true });\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\twindow.storage = storage;\r\n};"],"names":[],"sourceRoot":""}