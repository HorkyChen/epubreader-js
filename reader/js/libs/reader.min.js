(EPUBJS=EPUBJS||{}).core={};var EPUBJS,TEXT_NODE=3,ELEMENT_NODE=1,COMMENT_NODE=8,DOCUMENT_NODE=9;EPUBJS.core.getEl=function(e){return document.getElementById(e)},EPUBJS.core.getEls=function(e){return document.getElementsByClassName(e)},EPUBJS.core.request=function(e,t,n){var o,r=window.URL,i=r?"blob":"arraybuffer",s=new RSVP.defer,a=new XMLHttpRequest,c=XMLHttpRequest.prototype;return"overrideMimeType"in c||Object.defineProperty(c,"overrideMimeType",{value:function(e){}}),a.onreadystatechange=function(){var e;this.readyState===this.DONE&&(200!==this.status&&0!==this.status||!this.response?s.reject({message:this.response,stack:(new Error).stack}):(e="xml"===t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"application/xml"):"xhtml"===t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"application/xhtml+xml"):"html"===t?this.responseXML?this.responseXML:(new DOMParser).parseFromString(this.response,"text/html"):"json"===t?JSON.parse(this.response):"blob"===t?r?this.response:new Blob([this.response]):this.response,s.resolve(e)))},a.open("GET",e,!0),n&&(a.withCredentials=!0),t||(o=EPUBJS.core.uri(e),t={htm:"html"}[t=o.extension]||t),"blob"===t&&(a.responseType=i),"json"===t&&a.setRequestHeader("Accept","application/json"),"xml"===t&&(a.responseType="document",a.overrideMimeType("text/xml")),"xhtml"===t&&(a.responseType="document"),"html"===t&&(a.responseType="document"),"binary"===t&&(a.responseType="arraybuffer"),a.send(),s.promise},EPUBJS.core.toArray=function(e){var t=[];for(var n in e){var o;Object.prototype.hasOwnProperty.call(e,n)&&((o=e[n]).ident=n,t.push(o))}return t},EPUBJS.core.uri=function(e){var t,n,o,r={protocol:"",host:"",path:"",origin:"",directory:"",base:"",filename:"",extension:"",fragment:"",href:e},i=e.indexOf("blob:"),s=e.indexOf("://"),a=e.indexOf("?"),c=e.indexOf("#");return 0===i?(r.protocol="blob",r.base=e.indexOf(0,c),r):(-1!==c&&(r.fragment=e.slice(c+1),e=e.slice(0,c)),-1!==a&&(r.search=e.slice(a+1),e=e.slice(0,a),href=r.href),-1!==s?(r.protocol=e.slice(0,s),-1===(o=(t=e.slice(s+3)).indexOf("/"))?(r.host=r.path,r.path=""):(r.host=t.slice(0,o),r.path=t.slice(o)),r.origin=r.protocol+"://"+r.host,r.directory=EPUBJS.core.folder(r.path),r.base=r.origin+r.directory):(r.path=e,r.directory=EPUBJS.core.folder(e),r.base=r.directory),r.filename=e.replace(r.base,""),-1!==(n=r.filename.lastIndexOf("."))&&(r.extension=r.filename.slice(n+1)),r)},EPUBJS.core.folder=function(e){var t=e.lastIndexOf("/");return-1===t&&"",e.slice(0,t+1)},EPUBJS.core.dataURLToBlob=function(e){var t,n,o,r,i,s=";base64,";if(-1===e.indexOf(s))return n=(t=e.split(","))[0].split(":")[1],o=t[1],new Blob([o],{type:n});n=(t=e.split(s))[0].split(":")[1],r=(o=window.atob(t[1])).length,i=new Uint8Array(r);for(var a=0;a<r;++a)i[a]=o.charCodeAt(a);return new Blob([i],{type:n})},EPUBJS.core.addScript=function(e,t,n){var o,r;r=!1,(o=document.createElement("script")).type="text/javascript",o.async=!1,o.src=e,o.onload=o.onreadystatechange=function(){r||this.readyState&&"complete"!==this.readyState||(r=!0,t&&t())},(n=n||document.body).appendChild(o)},EPUBJS.core.addScripts=function(e,t,n){var o=e.length,r=0,i=function(){r++,o===r?t&&t():EPUBJS.core.addScript(e[r],i,n)};EPUBJS.core.addScript(e[r],i,n)},EPUBJS.core.addCss=function(e,t,n){var o,r;r=!1,(o=document.createElement("link")).type="text/css",o.rel="stylesheet",o.href=e,o.onload=o.onreadystatechange=function(){r||this.readyState&&"complete"!==this.readyState||(r=!0,t&&t())},(n=n||document.body).appendChild(o)},EPUBJS.core.prefixed=function(e){var t=["Webkit","Moz","O","ms"],n=e[0].toUpperCase()+e.slice(1),o=t.length;if(void 0!==document.documentElement.style[e])return e;for(var r=0;r<o;r++)if(void 0!==document.documentElement.style[t[r]+n])return t[r]+n;return e},EPUBJS.core.resolveUrl=function(e,t){var n=[],o=EPUBJS.core.uri(t),r=e.split("/");return o.host?t:(r.pop(),t.split("/").forEach((function(e){".."===e?r.pop():n.push(e)})),r.concat(n).join("/"))},EPUBJS.core.uuid=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:7&n|8).toString(16)}))},EPUBJS.core.insert=function(e,t,n){var o=EPUBJS.core.locationOf(e,t,n);return t.splice(o,0,e),o},EPUBJS.core.locationOf=function(e,t,n,o,r){var i,s=o||0,a=r||t.length,c=parseInt(s+(a-s)/2);return n||(n=function(e,t){return e>t?1:e<t?-1:e===t?0:void 0}),a-s<=0?c:(i=n(t[c],e),a-s==1?i>0?c:c+1:0===i?c:-1===i?EPUBJS.core.locationOf(e,t,n,c,a):EPUBJS.core.locationOf(e,t,n,s,c))},EPUBJS.core.indexOfSorted=function(e,t,n,o,r){var i,s=o||0,a=r||t.length,c=parseInt(s+(a-s)/2);return n||(n=function(e,t){return e>t?1:e<t?-1:e===t?0:void 0}),a-s<=0?-1:(i=n(t[c],e),a-s==1?0===i?c:-1:0===i?c:-1===i?EPUBJS.core.indexOfSorted(e,t,n,c,a):EPUBJS.core.indexOfSorted(e,t,n,s,c))},EPUBJS.core.queue=function(e){var t=[],n=e,o=function(){var e;t.length&&(e=t.shift(),n[e.funcName].apply(e.context||n,e.args))};return{enqueue:function(e,n,o){return t.push({funcName:e,args:n,context:o}),t},dequeue:o,flush:function(){for(;t.length;)o()},clear:function(){t=[]},length:function(){return t.length}}},EPUBJS.core.getElementXPath=function(e){return e&&e.id?'//*[@id="'+e.id+'"]':EPUBJS.core.getElementTreeXPath(e)},EPUBJS.core.getElementTreeXPath=function(e){var t,n,o,r,i=[],s="http://www.w3.org/1999/xhtml"===e.ownerDocument.documentElement.getAttribute("xmlns");for(e.nodeType===Node.TEXT_NODE&&(t=EPUBJS.core.indexOfTextNode(e)+1,i.push("text()["+t+"]"),e=e.parentNode);e&&1===e.nodeType;e=e.parentNode){t=0;for(var a=e.previousSibling;a;a=a.previousSibling)a.nodeType!==Node.DOCUMENT_TYPE_NODE&&a.nodeName===e.nodeName&&++t;n=e.nodeName.toLowerCase(),o=s?"xhtml:"+n:n,r=t?"["+(t+1)+"]":"",i.splice(0,0,o+r)}return i.length?"./"+i.join("/"):null},EPUBJS.core.nsResolver=function(e){return{xhtml:"http://www.w3.org/1999/xhtml",epub:"http://www.idpf.org/2007/ops"}[e]||null},EPUBJS.core.cleanStringForXpath=function(e){var t=e.match(/[^'"]+|['"]/g);return"concat('',"+(t=t.map((function(e){return"'"===e?'"\'"':'"'===e?"'\"'":"'"+e+"'"}))).join(",")+")"},EPUBJS.core.indexOfTextNode=function(e){for(var t,n=e.parentNode.childNodes,o=-1,r=0;r<n.length&&((t=n[r]).nodeType===Node.TEXT_NODE&&o++,t!==e);r++);return o},EPUBJS.core.defaults=function(e){for(var t=1,n=arguments.length;t<n;t++){var o=arguments[t];for(var r in o)void 0===e[r]&&(e[r]=o[r])}return e},EPUBJS.core.extend=function(e){var t=[].slice.call(arguments,1);return t.forEach((function(t){t&&Object.getOwnPropertyNames(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))})),e},EPUBJS.core.clone=function(e){return EPUBJS.core.isArray(e)?e.slice():EPUBJS.core.extend({},e)},EPUBJS.core.isElement=function(e){return!(!e||1!==e.nodeType)},EPUBJS.core.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},EPUBJS.core.isString=function(e){return"string"==typeof e||e instanceof String},EPUBJS.core.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},EPUBJS.core.values=function(e){var t,n,o,r=-1;if(!e)return[];for(n=(t=Object.keys(e)).length,o=Array(n);++r<n;)o[r]=e[t[r]];return o},EPUBJS.core.indexOfNode=function(e,t){for(var n,o=e.parentNode.childNodes,r=-1,i=0;i<o.length&&((n=o[i]).nodeType===t&&r++,n!==e);i++);return r},EPUBJS.core.indexOfTextNode=function(e){return EPUBJS.core.indexOfNode(e,TEXT_NODE)},EPUBJS.core.indexOfElementNode=function(e){return EPUBJS.core.indexOfNode(e,ELEMENT_NODE)},(EPUBJS=EPUBJS||{}).reader={},EPUBJS.reader.plugins={},function(e,t){e.ePubReader;var n=e.ePubReader=function(e,t){return new EPUBJS.Reader(e,t)};"function"==typeof define&&define.amd?define((function(){return Reader})):"undefined"!=typeof module&&module.exports&&(module.exports=n)}(window,jQuery),EPUBJS.Reader=function(e,t){var n,o,r=this,i=$("#viewer").empty(),s=window.location.search;this.settings=EPUBJS.core.defaults(t||{},{bookPath:e,restore:!1,reload:!1,bookmarks:void 0,annotations:void 0,contained:void 0,bookKey:void 0,styles:void 0,sidebarReflow:!1,generatePagination:!1,history:!0}),s&&s.slice(1).split("&").forEach((function(e){var t=e.split("="),n=t[0],o=t[1]||"";r.settings[n]=decodeURIComponent(o)})),this.setBookKey(this.settings.bookPath),this.settings.restore&&this.isSaved()&&this.applySavedSettings(),this.settings.styles=this.settings.styles||{fontSize:"100%"},this.book=n=new ePub(this.settings.bookPath,this.settings),this.offline=!1,this.sidebarOpen=!1,this.settings.bookmarks||(this.settings.bookmarks=[]),this.settings.annotations||(this.settings.annotations=[]),this.settings.generatePagination&&n.generatePagination(i.width(),i.height()),this.rendition=n.renderTo("viewer",{ignoreClass:"annotator-hl",width:"100%",height:"100%"}),this.settings.previousLocationCfi?this.displayed=this.rendition.display(this.settings.previousLocationCfi):this.displayed=this.rendition.display(),n.ready.then(function(){r.ReaderController=EPUBJS.reader.ReaderController.call(r,n),r.SettingsController=EPUBJS.reader.SettingsController.call(r,n),r.ControlsController=EPUBJS.reader.ControlsController.call(r,n),r.SidebarController=EPUBJS.reader.SidebarController.call(r,n),r.BookmarksController=EPUBJS.reader.BookmarksController.call(r,n),r.NotesController=EPUBJS.reader.NotesController.call(r,n),window.addEventListener("hashchange",this.hashChanged.bind(this),!1),document.addEventListener("keydown",this.adjustFontSize.bind(this),!1),this.rendition.on("keydown",this.adjustFontSize.bind(this)),this.rendition.on("keydown",r.ReaderController.arrowKeys.bind(this)),this.rendition.on("selected",this.selectedRange.bind(this))}.bind(this)).then(function(){r.ReaderController.hideLoader()}.bind(this));var a=EPUBJS.reader.plugins;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(r[o]=EPUBJS.reader.plugins[o].call(r,n));return n.loaded.metadata.then((function(e){r.MetaController=EPUBJS.reader.MetaController.call(r,e)})),n.loaded.navigation.then((function(e){r.TocController=EPUBJS.reader.TocController.call(r,e)})),window.addEventListener("beforeunload",this.unload.bind(this),!1),this},EPUBJS.Reader.prototype.adjustFontSize=function(e){var t,n=e.ctrlKey||e.metaKey;if(this.settings.styles&&(this.settings.styles.fontSize||(this.settings.styles.fontSize="100%"),t=parseInt(this.settings.styles.fontSize.slice(0,-1)),n))switch(e.keyCode){case 187:e.preventDefault(),this.book.setStyle("fontSize",t+2+"%");break;case 189:e.preventDefault(),this.book.setStyle("fontSize",t-2+"%");break;case 48:e.preventDefault(),this.book.setStyle("fontSize","100%")}},EPUBJS.Reader.prototype.addBookmark=function(e){this.isBookmarked(e)>-1||(this.settings.bookmarks.push(e),this.trigger("reader:bookmarked",e))},EPUBJS.Reader.prototype.removeBookmark=function(e){var t=this.isBookmarked(e);-1!==t&&(this.settings.bookmarks.splice(t,1),this.trigger("reader:unbookmarked",t))},EPUBJS.Reader.prototype.isBookmarked=function(e){return this.settings.bookmarks.indexOf(e)},EPUBJS.Reader.prototype.clearBookmarks=function(){this.settings.bookmarks=[]},EPUBJS.Reader.prototype.addNote=function(e){this.settings.annotations.push(e)},EPUBJS.Reader.prototype.removeNote=function(e){var t=this.settings.annotations.indexOf(e);-1!==t&&delete this.settings.annotations[t]},EPUBJS.Reader.prototype.clearNotes=function(){this.settings.annotations=[]},EPUBJS.Reader.prototype.setBookKey=function(e){return this.settings.bookKey||(this.settings.bookKey="epubjsreader:"+EPUBJS.VERSION+":"+window.location.host+":"+e),this.settings.bookKey},EPUBJS.Reader.prototype.isSaved=function(e){return!!localStorage&&null!==localStorage.getItem(this.settings.bookKey)},EPUBJS.Reader.prototype.removeSavedSettings=function(){if(!localStorage)return!1;localStorage.removeItem(this.settings.bookKey)},EPUBJS.Reader.prototype.applySavedSettings=function(){if(!localStorage)return!1;var e;try{e=JSON.parse(localStorage.getItem(this.settings.bookKey))}catch(e){return!1}return!!e&&(e.styles&&(this.settings.styles=EPUBJS.core.defaults(this.settings.styles||{},e.styles)),this.settings=EPUBJS.core.defaults(this.settings,e),!0)},EPUBJS.Reader.prototype.saveSettings=function(){if(this.book){var e=this.rendition.currentLocation();e.start&&(this.settings.previousLocationCfi=e.start.cfi)}if(!localStorage)return!1;localStorage.setItem(this.settings.bookKey,JSON.stringify(this.settings))},EPUBJS.Reader.prototype.unload=function(){this.settings.restore&&localStorage&&this.saveSettings()},EPUBJS.Reader.prototype.hashChanged=function(){var e=window.location.hash.slice(1);this.rendition.display(e)},EPUBJS.Reader.prototype.selectedRange=function(e){var t="#"+e;this.settings.history&&window.location.hash!==t&&(history.pushState({},"",t),this.currentLocationCfi=e)},RSVP.EventTarget.mixin(EPUBJS.Reader.prototype),(EPUBJS=EPUBJS||{}).storage=function(){var e=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB;if(void 0===e)return console.warn("Storage: IndexedDB not available."),{init:function(){},get:function(){},set:function(){},clear:function(){}};var t;return{init:function(n){var o=e.open("epubjs-reader",1);o.onupgradeneeded=function(e){var t=e.target.result;!1===t.objectStoreNames.contains("entries")&&t.createObjectStore("entries")},o.onsuccess=function(e){(t=e.target.result).onerror=function(e){console.error("IndexedDB",e)},n()},o.onerror=function(e){console.error("IndexedDB",e)}},get:function(e){t.transaction(["entries"],"readwrite").objectStore("entries").get(0).onsuccess=function(t){e(t.target.result),console.log("storage.get")}},set:function(e,n){t.transaction(["entries"],"readwrite").objectStore("entries").put(e,0).onsuccess=function(){n(),console.log("storage.set")}},clear:function(){void 0!==t&&(t.transaction(["entries"],"readwrite").objectStore("entries").clear().onsuccess=function(){console.log("storage.clear")})}}},EPUBJS.reader.BookmarksController=function(){var e=this.book,t=this.rendition,n=$("#bookmarksView"),o=n.find("#bookmarks"),r=document.createDocumentFragment(),i=0,s=function(n){var o=document.createElement("li"),r=document.createElement("a");o.id="bookmark-"+i,o.classList.add("list_item");var s,a=e.spine.get(n);return a.index in e.navigation.toc?(s=e.navigation.toc[a.index],r.textContent=s.label):r.textContent=n,r.href=n,r.classList.add("bookmark_link"),r.addEventListener("click",(function(e){var n=this.getAttribute("href");t.display(n),e.preventDefault()}),!1),o.appendChild(r),i++,o};return this.settings.bookmarks.forEach((function(e){var t=s(e);r.appendChild(t)})),o.append(r),this.on("reader:bookmarked",(function(e){var t=s(e);o.append(t)})),this.on("reader:unbookmarked",(function(e){$("#bookmark-"+e).remove()})),{show:function(){n.show()},hide:function(){n.hide()}}},EPUBJS.reader.ControlsController=function(e){var t=this,n=this.rendition,o=($("#store"),$("#fullscreen")),r=($("#fullscreenicon"),$("#cancelfullscreenicon"),$("#slider")),i=($("#main"),$("#sidebar"),$("#settings")),s=$("#bookmark");return r.on("click",(function(){t.sidebarOpen?(t.SidebarController.hide(),r.addClass("icon-menu"),r.removeClass("icon-right")):(t.SidebarController.show(),r.addClass("icon-right"),r.removeClass("icon-menu"))})),"undefined"!=typeof screenfull&&(o.on("click",(function(){screenfull.toggle($("#container")[0])})),screenfull.raw&&document.addEventListener(screenfull.raw.fullscreenchange,(function(){fullscreen=screenfull.isFullscreen,fullscreen?o.addClass("icon-resize-small").removeClass("icon-resize-full"):o.addClass("icon-resize-full").removeClass("icon-resize-small")}))),i.on("click",(function(){t.SettingsController.show()})),s.on("click",(function(){var e=t.rendition.currentLocation().start.cfi;-1===t.isBookmarked(e)?(t.addBookmark(e),s.addClass("icon-bookmark").removeClass("icon-bookmark-empty")):(t.removeBookmark(e),s.removeClass("icon-bookmark").addClass("icon-bookmark-empty"))})),n.on("relocated",(function(e){var n=e.start.cfi,o="#"+n;-1===t.isBookmarked(n)?s.removeClass("icon-bookmark").addClass("icon-bookmark-empty"):s.addClass("icon-bookmark").removeClass("icon-bookmark-empty"),t.currentLocationCfi=n,t.settings.history&&window.location.hash!=o&&history.pushState({},"",o)})),{}},EPUBJS.reader.MetaController=function(e){var t=e.title,n=e.creator,o=$("#book-title"),r=$("#chapter-title"),i=$("#title-seperator");document.title=t+" – "+n,o.html(t),r.html(n),i.show()},EPUBJS.reader.NotesController=function(){var e=this.book,t=this.rendition,n=this,o=$("#notesView"),r=$("#notes"),i=$("#note-text"),s=$("#note-anchor"),a=n.settings.annotations,c=e.renderer,d=[],l=new ePub.CFI,u=function(){o.show()},h=function(o){var r,a,c,d,u,m=e.renderer.doc;if(m.caretPositionFromPoint?(a=(r=m.caretPositionFromPoint(o.clientX,o.clientY)).offsetNode,c=r.offset):m.caretRangeFromPoint&&(a=(r=m.caretRangeFromPoint(o.clientX,o.clientY)).startContainer,c=r.startOffset),3!==a.nodeType)for(var g=0;g<a.childNodes.length;g++)if(3==a.childNodes[g].nodeType){a=a.childNodes[g];break}-1===(c=a.textContent.indexOf(".",c))?c=a.length:c+=1,d=l.generateCfiFromTextNode(a,c,e.renderer.currentChapter.cfiBase),u={annotatedAt:new Date,anchor:d,body:i.val()},n.addNote(u),p(u),f(u),i.val(""),s.text("Attach"),i.prop("disabled",!1),t.off("click",h)},p=function(e){var n=document.createElement("li"),o=document.createElement("a");n.innerHTML=e.body,o.innerHTML=" context &#187;",o.href="#"+e.anchor,o.onclick=function(){return t.display(e.anchor),!1},n.appendChild(o),r.append(n)},f=function(t){var n=e.renderer.doc,o=document.createElement("span"),r=document.createElement("a");o.classList.add("footnotesuperscript","reader_generated"),o.style.verticalAlign="super",o.style.fontSize=".75em",o.style.lineHeight="1em",r.style.padding="2px",r.style.backgroundColor="#fffa96",r.style.borderRadius="5px",r.style.cursor="pointer",o.id="note-"+EPUBJS.core.uuid(),r.innerHTML=a.indexOf(t)+1+"[Reader]",o.appendChild(r),l.addMarker(t.anchor,n,o),m(o,t.body)},m=function(e,o){var r=e.id,i=function(){d[r].classList.add("on")},s=function(){d[r].classList.remove("on")},a=function(){setTimeout((function(){d[r].classList.remove("show")}),100)};e.addEventListener("mouseover",(function(){var n,l,u,h,p=c.height,f=c.width,m=225;d[r]||(d[r]=document.createElement("div"),d[r].setAttribute("class","popup"),pop_content=document.createElement("div"),d[r].appendChild(pop_content),pop_content.innerHTML=o,pop_content.setAttribute("class","pop_content"),c.render.document.body.appendChild(d[r]),d[r].addEventListener("mouseover",i,!1),d[r].addEventListener("mouseout",s,!1),t.on("locationChanged",a,this),t.on("locationChanged",s,this)),n=d[r],u=(l=e.getBoundingClientRect()).left,h=l.top,n.classList.add("show"),popRect=n.getBoundingClientRect(),n.style.left=u-popRect.width/2+"px",n.style.top=h+"px",m>p/2.5&&(m=p/2.5,pop_content.style.maxHeight=m+"px"),popRect.height+h>=p-25?(n.style.top=h-popRect.height+"px",n.classList.add("above")):n.classList.remove("above"),u-popRect.width<=0?(n.style.left=u+"px",n.classList.add("left")):n.classList.remove("left"),u+popRect.width/2>=f?(n.style.left=u-300+"px",popRect=n.getBoundingClientRect(),n.style.left=u-popRect.width+"px",popRect.height+h>=p-25?(n.style.top=h-popRect.height+"px",n.classList.add("above")):n.classList.remove("above"),n.classList.add("right")):n.classList.remove("right")}),!1),e.addEventListener("mouseout",a,!1),e.addEventListener("click",(function(){n.ReaderController.slideOut(),u()}),!1)};return s.on("click",(function(e){s.text("Cancel"),i.prop("disabled","true"),t.on("click",h)})),a.forEach((function(e){p(e)})),{show:u,hide:function(){o.hide()}}},EPUBJS.reader.ReaderController=function(e){var t=$("#main"),n=$("#divider"),o=$("#loader"),r=$("#next"),i=$("#prev"),s=this,a=(e=this.book,this.rendition),c=function(){n.addClass("show")},d=function(){n.removeClass("show")},l=function(t){37==t.keyCode&&("rtl"===e.package.metadata.direction?a.next():a.prev(),i.addClass("active"),!0,setTimeout((function(){!1,i.removeClass("active")}),100),t.preventDefault()),39==t.keyCode&&("rtl"===e.package.metadata.direction?a.prev():a.next(),r.addClass("active"),!0,setTimeout((function(){!1,r.removeClass("active")}),100),t.preventDefault())};return document.addEventListener("keydown",l,!1),r.on("click",(function(t){"rtl"===e.package.metadata.direction?a.prev():a.next(),t.preventDefault()})),i.on("click",(function(t){"rtl"===e.package.metadata.direction?a.next():a.prev(),t.preventDefault()})),a.on("layout",(function(e){!0===e.spread?c():d()})),a.on("relocated",(function(e){e.atStart&&i.addClass("disabled"),e.atEnd&&r.addClass("disabled")})),{slideOut:function(){s.settings.sidebarReflow?(t.addClass("single"),t.one("transitionend",(function(){a.resize()}))):t.addClass("closed")},slideIn:function(){s.settings.sidebarReflow?(t.removeClass("single"),t.one("transitionend",(function(){a.resize()}))):t.removeClass("closed")},showLoader:function(){o.show(),d()},hideLoader:function(){o.hide()},showDivider:c,hideDivider:d,arrowKeys:l}},EPUBJS.reader.SettingsController=function(){this.book;var e=this,t=$("#settings-modal"),n=$(".overlay"),o=function(){t.removeClass("md-show")};return $("#sidebarReflow").on("click",(function(){e.settings.sidebarReflow=!e.settings.sidebarReflow})),t.find(".closer").on("click",(function(){o()})),n.on("click",(function(){o()})),{show:function(){t.addClass("md-show")},hide:o}},EPUBJS.reader.SidebarController=function(e){var t=this,n=$("#sidebar"),o=$("#panels"),r="Toc",i=function(e){var n=e+"Controller";r!=e&&void 0!==t[n]&&(t[r+"Controller"].hide(),t[n].show(),r=e,o.find(".active").removeClass("active"),o.find("#show-"+e).addClass("active"))};return o.find(".show_view").on("click",(function(e){var t=$(this).data("view");i(t),e.preventDefault()})),{show:function(){t.sidebarOpen=!0,t.ReaderController.slideOut(),n.addClass("open")},hide:function(){t.sidebarOpen=!1,t.ReaderController.slideIn(),n.removeClass("open")},getActivePanel:function(){return r},changePanelTo:i}},EPUBJS.reader.TocController=function(e){this.book;var t=this.rendition,n=$("#tocView").empty(),o=document.createDocumentFragment(),r=function(e,t){var n=document.createElement("ul");return t||(t=1),e.forEach((function(e){var o,i=document.createElement("li"),s=document.createElement("a");toggle=document.createElement("a"),i.id="toc-"+e.id,i.classList.add("list_item"),s.textContent=e.label,s.href=e.href,s.classList.add("toc_link"),i.appendChild(s),e.subitems&&e.subitems.length>0&&(t++,o=r(e.subitems,t),toggle.classList.add("toc_toggle"),i.insertBefore(toggle,s),i.appendChild(o)),n.appendChild(i)})),n};t.on("renderered",(function(e){var t=e.id,o=n.find("#toc-"+t),r=n.find(".currentChapter");n.find(".openChapter");o.length&&(o!=r&&o.has(false).length>0&&r.removeClass("currentChapter"),o.addClass("currentChapter"),o.parents("li").addClass("openChapter"))}));var i=r(e);return o.appendChild(i),n.append(o),n.find(".toc_link").on("click",(function(e){var o=this.getAttribute("href");e.preventDefault(),t.display(o),n.find(".currentChapter").addClass("openChapter").removeClass("currentChapter"),$(this).parent("li").addClass("currentChapter")})),n.find(".toc_toggle").on("click",(function(e){var t=$(this).parent("li"),n=t.hasClass("openChapter");e.preventDefault(),n?t.removeClass("openChapter"):t.addClass("openChapter")})),{show:function(){n.show()},hide:function(){n.hide()}}};